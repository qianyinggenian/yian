{"version":3,"file":"js/379.ef91be2d.js","mappings":"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","sources":["webpack://yian/./src/views/PDFMerge/index.vue","webpack://yian/src/views/PDFMerge/index.vue","webpack://yian/./src/views/PDFMerge/index.vue?900b","webpack://yian/./src/views/PDFMerge/index.vue?21f3"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"pdf-viewer\"},[_c('div',{staticClass:\"file-box\"},[_c('div',{staticClass:\"file-select-box\"},[_c('div',{staticClass:\"item\"},[_c('input',{ref:\"uploadBtn\",staticStyle:{\"display\":\"none\"},attrs:{\"type\":\"file\",\"accept\":\".pdf\",\"multiple\":\"\"},on:{\"change\":_vm.onFileChange}}),_c('el-button',{attrs:{\"size\":\"small\"},on:{\"click\":_vm.handleUpload}},[_vm._v(\"选择文件\")]),_c('span',{staticClass:\"file-accept-tips\"},[_vm._v(\"仅可上传pdf文件\")]),(_vm.totalPages > 0)?_c('span',[_vm._v(\" 总共：\"+_vm._s(_vm.totalPages)+\"页\")]):_vm._e()],1),_c('div',{staticClass:\"item\"},[_c('el-button',{staticClass:\"download-btn\",attrs:{\"size\":\"small\",\"loading\":_vm.loading},on:{\"click\":_vm.convertToPdfAndDownload}},[_vm._v(\" 下载 \")])],1)]),_c('div',{staticClass:\"file-list\"},_vm._l((_vm.files),function(file,index){return _c('div',{key:index,staticClass:\"item\"},[_c('div',{staticClass:\"icon\"},[_c('svg-icon',{attrs:{\"icon-class\":\"pdf2\",\"size\":40}})],1),_c('div',{staticClass:\"content\",attrs:{\"title\":file.name}},[_c('span',[_vm._v(_vm._s(file.name))])]),_c('div',{staticClass:\"delete-file\",on:{\"click\":function($event){return _vm.deleteFile(file,index)}}},[_c('svg-icon',{attrs:{\"icon-class\":\"delete\",\"fill\":\"#dc2e1b\",\"size\":20}})],1)])}),0)]),(_vm.totalPages > 0)?_c('div',{staticClass:\"pdf-Box\"},[_vm._l((_vm.totalPages),function(_,index){return _c('canvas',{key:index,ref:\"pages\",refInFor:true,attrs:{\"id\":index}})}),_c('el-backtop',{attrs:{\"target\":\".pdf-Box\"}})],2):_vm._e()])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"pdf-viewer\" >\n    <div class=\"file-box\">\n      <div class=\"file-select-box\">\n        <div class=\"item\">\n          <input style=\"display: none\" type=\"file\" ref=\"uploadBtn\" accept=\".pdf\" multiple  @change=\"onFileChange\">\n          <el-button size=\"small\" @click=\"handleUpload\">选择文件</el-button>\n          <span class=\"file-accept-tips\">仅可上传pdf文件</span>\n          <span v-if=\"totalPages > 0\"> 总共：{{totalPages}}页</span>\n        </div>\n        <div class=\"item\">\n          <el-button\n              size=\"small\"\n              class=\"download-btn\"\n              :loading=\"loading\"\n              @click=\"convertToPdfAndDownload\">\n            下载\n          </el-button>\n        </div>\n\n      </div>\n      <div class=\"file-list\">\n        <div class=\"item\" v-for=\"(file,index) in files\" :key=\"index\">\n<!--        <div class=\"item\" v-for=\"(item,index) in 25\" :key=\"index\">-->\n          <div class=\"icon\">\n            <svg-icon icon-class=\"pdf2\" :size=\"40\"></svg-icon>\n          </div>\n          <div class=\"content\" :title=\"file.name\">\n            <span>{{file.name}}</span>\n          </div>\n          <div class=\"delete-file\" @click=\"deleteFile(file,index)\">\n            <svg-icon icon-class=\"delete\" fill=\"#dc2e1b\" :size=\"20\"></svg-icon>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"pdf-Box\" v-if=\"totalPages > 0\">\n      <canvas :id=\"index\"  v-for=\"(_, index) in totalPages\" :key=\"index\" ref=\"pages\"></canvas>\n      <el-backtop target=\".pdf-Box\"></el-backtop>\n    </div>\n  </div>\n</template>\n<script>\nimport JsPDF from 'jspdf';\nimport * as pdfjsLib from 'pdfjs-dist';\nimport 'pdfjs-dist/build/pdf.worker.min';\nexport default {\n  name: 'index',\n  components: {},\n  data () {\n    return {\n      loading: false,\n      selectedFile: null,\n      pdfDocument: null,\n      arrayBuffer: null,\n      totalPages: 0,\n      pdfFiles: [],\n      fileName: '',\n      files: [],\n      fontFamilyList: [\n        {\n          value: 'Arial',\n          label: 'Arial'\n        },\n        {\n          value: '宋体',\n          label: '宋体'\n        },\n        {\n          value: '楷体',\n          label: '楷体'\n        },\n        {\n          value: '仿宋',\n          label: '仿宋'\n        },\n        {\n          value: '黑体',\n          label: '黑体'\n        },\n        {\n          value: '等线',\n          label: '等线'\n        },\n        {\n          value: '微软雅黑',\n          label: '微软雅黑'\n        },\n        {\n          value: '思源黑体',\n          label: '思源黑体'\n        },\n        {\n          value: 'Times New Roman',\n          label: 'Times New Roman'\n        },\n        {\n          value: 'Helvetica Neue',\n          label: 'Helvetica Neue'\n        },\n        {\n          value: 'Helvetica',\n          label: 'Helvetica'\n        },\n        {\n          value: 'PingFang SC',\n          label: 'PingFang SC'\n        },\n        {\n          value: 'Hiragino Sans GB',\n          label: 'Hiragino Sans GB'\n        },\n        {\n          value: 'Microsoft YaHei',\n          label: 'Microsoft YaHei'\n        },\n        {\n          value: 'sans-serif',\n          label: 'sans-serif'\n        }\n      ],\n      form: {\n        watermarkText: 'Watermark',\n        tiltAngle: -30,\n        fontFamily: 'Arial',\n        watermarkOpacity: 0.5,\n        fontSize: 20,\n        textSpacing: 150,\n        fontColor: '#D02424'\n      }\n    };\n  },\n  props: {},\n  watch: {},\n  computed: {},\n  created () {},\n  mounted () {},\n  methods: {\n    /**\n     * @Description\n     * @author qianyinggenian\n     * @date 2024/3/19\n     */\n    handleUpload () {\n      this.$refs.uploadBtn.value = '';\n      this.$refs.uploadBtn.click();\n    },\n    /**\n     * @Description 删除文件\n     * @author qianyinggenian\n     * @date 2024/3/19\n     */\n    deleteFile (file, index) {\n      this.files.splice(index, 1);\n      this.totalPages = 0;\n      console.log('this.files', this.files);\n      for (const file of this.files) {\n        if (file.type.includes('application/pdf')) {\n          this.resetWatermark(file);\n        } else {\n          this.$message.error('请选择PDF文件！');\n        }\n      }\n    },\n    /**\n     * @Description 选择文件后触发\n     * @author qianyinggenian\n     * @date 2024/3/18\n     */\n    async onFileChange (event) {\n      const files = event.target.files;\n      // this.files = files;\n      this.selectedFile = files;\n      this.files = Array.from(files);\n      for (const file of files) {\n        if (file.type.includes('application/pdf')) {\n          await this.resetWatermark(file);\n        } else {\n          this.$message.error('请选择PDF文件！');\n        }\n      }\n    },\n    /**\n     * @Description 重置水印\n     * @author qianyinggenian\n     * @date 2024/3/19\n     */\n    async resetWatermark (file) {\n      const arrayBuffer = await this.readFileAsArrayBuffer(file);\n      if (this.files && this.files.length > 0) {\n        await this.loadPDF(arrayBuffer);\n      }\n    },\n    /**\n     * @Description 读取文件为ArrayBuffer\n     * @author qianyinggenian\n     * @date 2024/3/18\n     */\n    readFileAsArrayBuffer (file) {\n      return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onloadend = () => {\n          if (reader.result instanceof ArrayBuffer) {\n            resolve(reader.result);\n          } else {\n            reject(new Error('Failed to read the file as ArrayBuffer'));\n          }\n        };\n        reader.onerror = reject;\n        reader.readAsArrayBuffer(file);\n      });\n    },\n    async loadPDF (data) {\n      const loadingTask = pdfjsLib.getDocument({ data });\n      const pdfDocument = await loadingTask.promise;\n      const numPages = pdfDocument.numPages;\n      const startPageNum = this.totalPages === 0 ? 0 : this.totalPages;\n      this.totalPages += numPages;\n      if (pdfDocument && this.totalPages > 0) {\n        this.$nextTick(() => {\n          this.renderAllPages(pdfDocument, startPageNum, numPages);\n        });\n      }\n    },\n    /**\n     * @Description 渲染\n     * @author qianyinggenian\n     * @date 2024/3/18\n     */\n    async renderAllPages (pdfDocument, startPageNum, numPages) {\n      for (let pageNum = startPageNum; pageNum < this.totalPages; pageNum++) {\n        this.$nextTick(async () => {\n          const canvas = this.$refs.pages[pageNum];\n          if (!canvas) {\n            console.error(`Canvas element for page ${pageNum} not found.`);\n            return false;\n          }\n          // const page = await this.pdfDocument.getPage(pageNum);\n          const pdfPageNum = startPageNum === 0 ? pageNum + 1 : pageNum + 1 - startPageNum;\n          const page = await pdfDocument.getPage(pdfPageNum);\n          const viewport = page.getViewport({ scale: 2 });\n          canvas.width = viewport.width;\n          canvas.height = viewport.height;\n          const context = canvas.getContext('2d');\n          context.clearRect(0, 0, canvas.width, canvas.height); // 清除canvas上的所有内容\n          const renderContext = {\n            canvasContext: context,\n            viewport\n          };\n\n          await page.render(renderContext).promise;\n          // this.drawWatermark(context, pageNum, canvas);\n        });\n      }\n    },\n    /**\n     * @Description 添加水印\n     * @author qianyinggenian\n     * @date 2024/3/18\n     */\n    drawWatermark (context, pageNumber, canvas) {\n      const {\n        watermarkText,\n        tiltAngle,\n        fontSize,\n        fontColor,\n        watermarkOpacity,\n        fontFamily,\n        textSpacing\n      } = this.form;\n      // const textSpacing = 150; // 水印之间的间距\n      const num = Math.max(canvas.width, canvas.height);\n      const numWatermarks = Math.ceil(num / textSpacing);\n\n      for (let i = 0; i < numWatermarks; i++) {\n        for (let j = 0; j < numWatermarks; j++) {\n          const x = j * textSpacing;\n          const y = i * textSpacing;\n          context.save();\n          context.translate(x, y);\n          context.rotate((tiltAngle * Math.PI) / 180);\n          context.font = `bold ${fontSize}px ${fontFamily}`;\n          context.fillStyle = fontColor;\n          context.globalAlpha = watermarkOpacity;\n          context.fillText(`${watermarkText}`, 0, fontSize);\n          context.restore();\n        }\n      }\n    },\n    /**\n     * @Description 下载pdf\n     * @author qianyinggenian\n     * @date 2024/3/18\n     */\n    async downloadPDF () {\n      if (this.files && this.files.length > 0) {\n        const doc = new JsPDF('p', 'mm', 'a4'); // 设置为纵向、毫米单位、A4纸张\n\n        const canvases = this.$refs.pages; // 示例中包含两个canvas\n\n        for (let i = 0; i < canvases.length; i++) {\n          const canvas = canvases[i];\n          const canvasElement = canvas.getContext('2d').canvas; // 获取canvas DOM元素\n\n          // 计算canvas在PDF页面上的居中坐标\n          // const canvasWidth = canvasElement.width;\n          // const canvasHeight = canvasElement.height;\n          const pdfWidth = doc.internal.pageSize.getWidth();\n          const pdfHeight = doc.internal.pageSize.getHeight();\n\n          // 将canvas转换为data URL\n          const dataUrl = canvasElement.toDataURL();\n\n          // 将data URL转换为image\n          const img = new Image();\n          img.src = dataUrl;\n          await new Promise((resolve) => {\n            img.onload = () => resolve();\n          });\n\n          // 添加图像至PDF，并居中显示\n          // doc.addImage(img, 'PNG', centerX, centerY, canvasWidth, canvasHeight);\n          doc.addImage(img, 'PNG', 0, 0, pdfWidth, pdfHeight);\n\n          // 如果有更多canvas且不是最后一张，则增加新页\n          if (i !== canvases.length - 1) {\n            doc.addPage();\n          }\n        }\n\n        // 生成并下载PDF文件\n        // doc.save(`${this.fileName}.pdf`);\n        doc.save(`水印-${this.fileName}`);\n      } else {\n        this.$message.error('请选择PDF文件！');\n      }\n    },\n    /**\n     * @Description 下载pdf\n     * @author qianyinggenian\n     * @date 2024/3/18\n     */\n    async convertToPdfAndDownload () {\n      if (this.files && this.files.length > 0) {\n        this.$message.success('开始下载');\n        this.loading = true;\n        const pdf = new JsPDF('p', 'mm', 'a4'); // 初始化PDF文档\n\n        // 遍历所有的canvas元素\n        const canvases = this.$refs.pages; // 示例列表，根据实际情况替换为你的canvas refs\n        for (let i = 0; i < canvases.length; i++) {\n          const canvasRef = canvases[i];\n          // 将canvas转换为图像数据\n          const canvasImgData = canvasRef.toDataURL('image/jpeg', 1.0);\n          // const canvasImgData = canvas.toDataURL('image/jpeg');\n\n          // 将图像数据转换为PDF可用的图像\n          const img = await this.loadImage(canvasImgData);\n          // 获取canvas的实际大小\n          // const canvasWidth = canvas.clientWidth;\n          // const canvasHeight = canvas.clientHeight;\n          // console.log(canvasWidth, canvasWidth);\n          // console.log(canvasHeight, canvasHeight);\n          const pdfWidth = pdf.internal.pageSize.getWidth();\n          const pdfHeight = pdf.internal.pageSize.getHeight();\n          // 添加图像到PDF文档\n          // pdf.addImage(img, 'JPEG', 15, 40, canvasWidth, canvasHeight); // 调整坐标和尺寸以适应你的布局\n          pdf.addImage(img, 'JPEG', 0, 0, pdfWidth, pdfHeight); // 调整坐标和尺寸以适应你的布局\n\n          // 添加页面分隔（如果需要在每个canvas后换页）\n          // 如果有更多canvas且不是最后一张，则增加新页\n          if (i !== canvases.length - 1) {\n            pdf.addPage();\n          }\n        }\n\n        // 生成并下载PDF文件\n        // pdf.save(`${this.fileName}.pdf`);\n        this.$message.success('完成');\n        this.loading = false;\n        pdf.save('pdf合并文件.pdf');\n      } else {\n        this.$message.error('请选择PDF文件！');\n      }\n    },\n    loadImage (dataUrl) {\n      return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.src = dataUrl;\n        img.onload = () => resolve(img);\n        img.onerror = reject;\n      });\n    }\n  }\n};\n</script>\n<style scoped lang=\"scss\">\n.pdf-viewer {\n  width: 100%;\n  height: 100%;\n  padding: 10px;\n  display: flex;\n\n  flex-direction: column;\n  box-sizing: border-box;\n  .file-box {\n    padding: 10px;\n    border: 1px solid var(--border-color);\n    box-sizing: border-box;\n    .file-select-box {\n      display: flex;\n      align-items: center;\n      .item {\n        flex: 1 0 auto;\n      }\n      .file-accept-tips {\n        margin-left: 10px;\n        margin-right: 50px;\n      }\n    }\n    .file-list {\n      display: flex;\n      flex-flow: row;\n      flex-wrap: wrap;\n      margin-top: 10px;\n      gap: 10px;\n      .item {\n        width: 250px;\n        height: 50px;\n        display: flex;\n        margin-right: 10px;\n        margin-bottom: 10px;\n        box-sizing: border-box;\n        padding: 5px;\n        cursor: pointer;\n        position: relative;\n        border: 1px solid var(--border-color);\n        .icon {\n          height: 40px;\n          width: 40px;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          flex-shrink: 0;\n        }\n        .content {\n          height: 40px;\n          width: 190px;\n          display: flex;\n          margin-left: 5px;\n          align-items: center;\n          span {\n            overflow: hidden;\n            text-overflow:ellipsis;\n            white-space: nowrap;\n            word-break: break-word; /* 对于英文单词，防止溢出容器 */\n          }\n        }\n        .delete-file {\n          display: none;\n          position: absolute;\n          right: 7px;\n          top: 1px;\n          width: 15px;\n          height: 15px;\n        }\n        &:hover {\n          .delete-file {\n            display: block;\n          }\n        }\n      }\n    }\n  }\n  .pdf-Box {\n    margin-top: 5px;\n    border: 1px solid red;\n    padding: 5px;\n    box-sizing: border-box;\n    overflow-y: auto;\n    canvas {\n      width: calc(100% - 10px);\n      margin: 0 5px 10px 5px;\n    }\n  }\n  .download-btn {\n    width: 80px;\n  }\n}\n::v-deep .el-icon-loading {\n  font-size: 14px !important;\n}\n</style>\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=52894de5&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=52894de5&prod&scoped=true&lang=scss\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"52894de5\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","ref","staticStyle","attrs","on","onFileChange","handleUpload","_v","totalPages","_s","_e","loading","convertToPdfAndDownload","_l","files","file","index","key","name","$event","deleteFile","_","refInFor","staticRenderFns","components","data","selectedFile","pdfDocument","arrayBuffer","pdfFiles","fileName","fontFamilyList","value","label","form","watermarkText","tiltAngle","fontFamily","watermarkOpacity","fontSize","textSpacing","fontColor","props","watch","computed","created","mounted","methods","$refs","uploadBtn","click","splice","console","log","type","includes","resetWatermark","$message","error","event","target","Array","from","readFileAsArrayBuffer","length","loadPDF","Promise","resolve","reject","reader","FileReader","onloadend","result","ArrayBuffer","Error","onerror","readAsArrayBuffer","loadingTask","pdfjsLib","promise","numPages","startPageNum","$nextTick","renderAllPages","pageNum","canvas","pages","pdfPageNum","page","getPage","viewport","getViewport","scale","width","height","context","getContext","clearRect","renderContext","canvasContext","drawWatermark","pageNumber","num","Math","max","numWatermarks","ceil","i","j","x","y","save","translate","rotate","PI","font","fillStyle","globalAlpha","fillText","restore","downloadPDF","doc","JsPDF","canvases","canvasElement","pdfWidth","internal","pageSize","getWidth","pdfHeight","getHeight","dataUrl","toDataURL","img","Image","src","onload","addImage","addPage","success","pdf","canvasRef","canvasImgData","loadImage","component"],"sourceRoot":""}