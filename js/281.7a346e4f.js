"use strict";(self["webpackChunkyian"]=self["webpackChunkyian"]||[]).push([[281],{99281:function(e,a,t){t.a(e,(async function(e,l){try{t.r(a);var s=t(3882),n=t(88830),i=(t(46004),t(81656)),o=e([n]);n=(o.then?(await o)():o)[0];var r=(0,i.A)(n.A,s.X,s.Y,!1,null,"de08b9fc",null);a["default"]=r.exports,l()}catch(c){l(c)}}))},46004:function(){},88830:function(e,a,t){t.a(e,(async function(e,l){try{var s=t(31499),n=e([s]);s=(n.then?(await n)():n)[0],a.A=s.A,l()}catch(i){l(i)}}))},3882:function(e,a,t){t.d(a,{X:function(){return l},Y:function(){return s}});var l=function(){var e=this,a=e._self._c;return a("div",{staticClass:"pdf-viewer"},[a("div",{staticClass:"file-box"},[a("div",{staticClass:"file-select-box"},[a("input",{ref:"uploadBtn",staticStyle:{display:"none"},attrs:{type:"file",accept:".pdf",multiple:""},on:{change:e.onFileChange}}),a("el-button",{attrs:{size:"small"},on:{click:e.handleUpload}},[e._v("选择文件")]),a("span",{staticClass:"file-accept-tips"},[e._v("pdf文件")]),a("el-button",{attrs:{size:"small"},on:{click:e.convertToPdfAndDownload}},[e._v("下载")])],1),a("div",{staticClass:"file-list"},e._l(e.selectedFile,(function(t,l){return a("div",{key:l,staticClass:"item"},[e._v(e._s(t.name))])})),0)]),e.totalPages>0?a("div",{staticClass:"pdf-Box"},e._l(e.totalPages,(function(e,t){return a("canvas",{key:t,ref:"pages",refInFor:!0,attrs:{id:t}})})),0):e._e()])},s=[]},31499:function(e,a,t){t.a(e,(async function(e,l){try{var s=t(44323),n=t(91100),i=(t(85098),e([n]));n=(i.then?(await i)():i)[0],a.A={name:"index",components:{},data(){return{selectedFile:null,pdfDocument:null,arrayBuffer:null,totalPages:0,files:[],pdfFiles:[],fileName:"",fontFamilyList:[{value:"Arial",label:"Arial"},{value:"宋体",label:"宋体"},{value:"楷体",label:"楷体"},{value:"仿宋",label:"仿宋"},{value:"黑体",label:"黑体"},{value:"等线",label:"等线"},{value:"微软雅黑",label:"微软雅黑"},{value:"思源黑体",label:"思源黑体"},{value:"Times New Roman",label:"Times New Roman"},{value:"Helvetica Neue",label:"Helvetica Neue"},{value:"Helvetica",label:"Helvetica"},{value:"PingFang SC",label:"PingFang SC"},{value:"Hiragino Sans GB",label:"Hiragino Sans GB"},{value:"Microsoft YaHei",label:"Microsoft YaHei"},{value:"sans-serif",label:"sans-serif"}],form:{watermarkText:"Watermark",tiltAngle:-30,fontFamily:"Arial",watermarkOpacity:.5,fontSize:20,textSpacing:150,fontColor:"#D02424"}}},props:{},watch:{},computed:{},created(){},mounted(){},methods:{handleUpload(){this.$refs.uploadBtn.click()},async onFileChange(e){const a=e.target.files[0],t=e.target.files;this.selectedFile=t,console.log("file",a),console.log("files",t);for(const l of t)await this.resetWatermark(l)},async resetWatermark(e){const a=await this.readFileAsArrayBuffer(e);this.selectedFile&&await this.loadPDF(a)},readFileAsArrayBuffer(e){return new Promise(((a,t)=>{const l=new FileReader;l.onloadend=()=>{l.result instanceof ArrayBuffer?a(l.result):t(new Error("Failed to read the file as ArrayBuffer"))},l.onerror=t,l.readAsArrayBuffer(e)}))},async loadPDF(e){const a=n.YE({data:e}),t=await a.promise,l=t.numPages;console.log("totalPagestotalPages",this.totalPages);const s=0===this.totalPages?0:this.totalPages;this.totalPages+=l,console.log("totalPages",this.totalPages),t&&this.totalPages>0&&this.$nextTick((()=>{this.renderAllPages(t,s,l)}))},async renderAllPages(e,a,t){console.log("startPageNum",a),console.log("numPages",t);for(let l=a;l<this.totalPages;l++)console.log("pageNum",l),this.$nextTick((async()=>{const t=this.$refs.pages[l];if(!t)return console.error(`Canvas element for page ${l} not found.`),!1;const s=0===a?l+1:l+1-a,n=await e.getPage(s),i=n.getViewport({scale:2});t.width=i.width,t.height=i.height;const o=t.getContext("2d");o.clearRect(0,0,t.width,t.height);const r={canvasContext:o,viewport:i};await n.render(r).promise,this.drawWatermark(o,l,t)}))},drawWatermark(e,a,t){const{watermarkText:l,tiltAngle:s,fontSize:n,fontColor:i,watermarkOpacity:o,fontFamily:r,textSpacing:c}=this.form,f=Math.max(t.width,t.height),d=Math.ceil(f/c);for(let g=0;g<d;g++)for(let a=0;a<d;a++){const t=a*c,f=g*c;e.save(),e.translate(t,f),e.rotate(s*Math.PI/180),e.font=`bold ${n}px ${r}`,e.fillStyle=i,e.globalAlpha=o,e.fillText(`${l}`,0,n),e.restore()}},async downloadPDF(){if(this.selectedFile){const e=new s.Ay("p","mm","a4"),a=this.$refs.pages;for(let t=0;t<a.length;t++){const l=a[t],s=l.getContext("2d").canvas,n=e.internal.pageSize.getWidth(),i=e.internal.pageSize.getHeight(),o=s.toDataURL(),r=new Image;r.src=o,await new Promise((e=>{r.onload=()=>e()})),e.addImage(r,"PNG",0,0,n,i),t!==a.length-1&&e.addPage()}e.save(`水印-${this.fileName}`)}else this.$message.error("请选择PDF文件！")},async convertToPdfAndDownload(){if(this.selectedFile){const e=new s.Ay("p","mm","a4"),a=this.$refs.pages;for(let t=0;t<a.length;t++){const l=a[t],s=l.toDataURL("image/jpeg",1),n=await this.loadImage(s),i=e.internal.pageSize.getWidth(),o=e.internal.pageSize.getHeight();e.addImage(n,"JPEG",0,0,i,o),t!==a.length-1&&e.addPage()}e.save("pdf合并文件.pdf")}else this.$message.error("请选择PDF文件！")},loadImage(e){return new Promise(((a,t)=>{const l=new Image;l.src=e,l.onload=()=>a(l),l.onerror=t}))}}},l()}catch(o){l(o)}}))}}]);
//# sourceMappingURL=281.7a346e4f.js.map