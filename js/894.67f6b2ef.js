"use strict";(self["webpackChunkyian"]=self["webpackChunkyian"]||[]).push([[894],{47273:function(e,t,r){r.d(t,{Z:function(){return c}});var s=function(){var e=this;e._self._c;return e._m(0)},i=[function(){var e=this,t=e._self._c;return t("div",[t("ul",{staticClass:"schema-tree-plus",attrs:{id:"treeDemo"}})])}];class o{constructor(e){this.resourcesTree=e,this.treeNode=null}getTree(){return this.resourcesTree}setOnClick(e){this.resourcesTree.setting.callback.onClick=e}setOnDblClick(e){this.resourcesTree.setting.callback.onDblClick=e}setOnDrag(e){this.resourcesTree.setting.callback.onDrag=e}setOnDrop(e){this.resourcesTree.setting.callback.onDrop=e}setBeforeClick(e){this.resourcesTree.setting.callback.beforeClick=e}setBeforeDblClick(e){this.resourcesTree.setting.callback.beforeDblClick=e}setBeforeExpand(e){this.resourcesTree.setting.callback.beforeExpand=e}setBeforeDrag(e){this.resourcesTree.setting.callback.beforeDrag=e}setBeforeDrop(e){this.resourcesTree.setting.callback.beforeDrop=e}setOnCheck(e){this.resourcesTree.setting.callback.onCheck=e}setBeforeCheck(e){this.resourcesTree.setting.callback.beforeCheck=e}getSelectNode(e){const t=e.target.id,r=t.split("Btn_"),s=$("#"+r[0]+r[1]).val();return this.resourcesTree.getNodeByTId(s)}}var l={name:"index",components:{},data(){return{treeTool:null,zTreeObj:{},defaultSetting:{view:{showIcon:!1,selectedMulti:!1},edit:{enable:!0,showRemoveBtn:!1,showRenameBtn:!1,drag:{isMove:!0,isCopy:!0}},data:{key:{name:"text"},simpleData:{enable:!0,idKey:"id",pIdKey:"parentId"}},check:{enable:!0}},zNodes:[]}},props:{setting:{type:Object,default:()=>{}},nodes:{type:Array,default:()=>[]},diyBeforeClick:{type:Function},diyBeforeCheck:{type:Function},isSelectFirstNode:{type:Boolean,default:!0},isSetOperatePrivilege:{type:Boolean,default:!1},setOperatePrivilege:{type:Function},expandLevel:{type:Number,default:1},expandAll:{type:Boolean,default:!1}},watch:{nodes:{handler(e,t){e!==t&&(this.zNodes=JSON.parse(JSON.stringify(e)),this.$nextTick((()=>{this.initZTree()})))},immediate:!0}},computed:{},mounted(){},methods:{initZTree(){const e=$.extend(!0,this.defaultSetting,this.setting),t=$.fn.zTree.init($("#treeDemo"),e,this.zNodes);if(this.zTreeObj=t,this.treeTool=new o(t),this.treeTool.setBeforeClick(this.beforeClick),this.treeTool.setBeforeCheck(this.beforeCheck),this.treeTool.setOnClick(this.clickNode),this.treeTool.setOnCheck(this.checkNode),this.isSetOperatePrivilege&&this.setOperatePrivilege&&"function"===typeof this.setOperatePrivilege&&this.setOperatePrivilege(this.zTreeObj),this.isSelectFirstNode){const e=this.zTreeObj.getNodes();this.zTreeObj.selectNode(e[0]),this.$emit("click",e[0])}if(this.expandAll)this.zTreeObj.expandAll(!0);else{let e=[];for(let t=0;t<=this.expandLevel;t++){const r=this.zTreeObj.getNodesByParam("level",t,null);e=[...e,...r]}e.forEach((e=>{this.zTreeObj.expandNode(e,!0,!1,!1)}))}this.$emit("treeObj",{zTreeObj:this.zTreeObj,treeTool:this.treeTool})},clickNode(e,t,r,s){e.preventDefault(),this.$emit("click",r)},beforeClick(e,t,r){return!this.diyBeforeClick||"function"!==typeof this.diyBeforeClick||this.diyBeforeClick(e,t,r)},checkNode(e,t,r){e.preventDefault();const s=this.zTreeObj.getCheckedNodes();this.$emit("check",r,s)},beforeCheck(e,t){return!this.diyBeforeCheck||"function"!==typeof this.diyBeforeCheck||this.diyBeforeCheck(e,t)}}},a=l,n=r(1001),d=(0,n.Z)(a,s,i,!1,null,"2ad75f1a",null),c=d.exports},34894:function(e,t,r){r.r(t),r.d(t,{default:function(){return T}});var s=function(){var e=this,t=e._self._c;return t("layout",[t("div",{attrs:{slot:"left"},slot:"left"},[t("ztree",{ref:"ztree",attrs:{nodes:e.nodes,setting:e.setting,"set-operate-privilege":e.setOperatePrivilege,"is-set-operate-privilege":!0},on:{treeObj:e.getTreeObj,click:e.handleClick}})],1),t("div",{attrs:{slot:"right"},slot:"right"},[t("add-edit",{ref:"addEdit",on:{refresh:e.refreshTree}})],1)])},i=[],o=r(47273),l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"form-container"},[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,size:"small","label-width":"100px"}},[t("el-row",{attrs:{type:"flex",justify:"space-between"}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"类型",prop:"type"}},[t("el-select",{attrs:{disabled:e.disabled,clearable:"",placeholder:"请选择"},on:{change:e.handleChangeType},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},e._l(e.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"编码",prop:"code"}},[t("el-input",{attrs:{disabled:e.disabled,clearable:"",placeholder:"请输入"},model:{value:e.ruleForm.code,callback:function(t){e.$set(e.ruleForm,"code",t)},expression:"ruleForm.code"}})],1)],1)],1),t("el-row",{attrs:{type:"flex",justify:"space-between"}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"名称",prop:"name"}},[t("el-input",{attrs:{disabled:e.disabled,clearable:"",placeholder:"请输入"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"权限",prop:"permission"}},[t("el-input",{attrs:{disabled:e.disabled,clearable:"",placeholder:"请输入"},model:{value:e.ruleForm.permission,callback:function(t){e.$set(e.ruleForm,"permission",t)},expression:"ruleForm.permission"}})],1)],1)],1),t("el-row",{attrs:{type:"flex",justify:"space-between"}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"路由",prop:"path",rules:"menu"===e.ruleForm.type?e.rules.path:[]}},[t("el-input",{attrs:{disabled:e.disabled,clearable:"",placeholder:"请输入"},model:{value:e.ruleForm.path,callback:function(t){e.$set(e.ruleForm,"path",t)},expression:"ruleForm.path"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"组件路径",prop:"comp"}},[t("el-input",{attrs:{disabled:e.disabled,clearable:"",placeholder:"请输入"},model:{value:e.ruleForm.comp,callback:function(t){e.$set(e.ruleForm,"comp",t)},expression:"ruleForm.comp"}})],1)],1)],1),t("el-row",{attrs:{type:"flex",justify:"space-between"}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"排序",prop:"sort"}},[t("el-input",{attrs:{disabled:e.disabled,clearable:"",placeholder:"请输入"},model:{value:e.ruleForm.sort,callback:function(t){e.$set(e.ruleForm,"sort",t)},expression:"ruleForm.sort"}})],1)],1),t("el-col",{attrs:{span:12}})],1)],1),t("div",{staticClass:"btns-box"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSave}},[e._v("保存")])],1)],1)},a=[],n=r(15623),d=r.n(n),c=r(64851);const u=d().Random;var h={name:"add-edit",components:{},data(){return{ruleForm:{code:"",type:""},disabled:!1,checkList:[],rules:{code:[{required:!0,message:"请输入",trigger:"blur"},{validator:this.codeValidator,trigger:"blur",transform:this.codeValidateTransform}],name:[{required:!0,message:"请输入",trigger:"blur"}],path:[{required:!0,message:"请输入",trigger:"blur"}],permission:[{required:!0,message:"请输入",trigger:"blur"}],type:[{required:!0,message:"请选择",trigger:"change"}]},treeNode:{},options:[{value:"btn",label:"按钮"},{value:"menu",label:"菜单"}]}},props:{},watch:{},computed:{},mounted(){},methods:{handleChangeType(e){this.rules.code="btn"===e?[{required:!0,message:"请输入",trigger:"blur"}]:[{required:!0,message:"请输入",trigger:"blur"},{validator:this.codeValidator,trigger:"blur",transform:this.codeValidateTransform}],this.$nextTick((()=>{this.$refs.ruleForm.validateField("code")}))},codeValidateTransform(e){return{code:e,id:this.ruleForm.id}},codeValidator(e,t,r){if(t.code){const e={key:"code",value:this.ruleForm.code,type:this.type,id:this.ruleForm.id};c.Z.menuUniqueness(e).then((e=>{const{data:t}=e;200===e.code&&(t.exist?r():r({state:"error",message:"该编码已存在"}))}))}else r()},async getInfo({treeNode:e,disabled:t,type:r}){if(this.treeNode=e,this.disabled=t,this.type=r,"add"!==r){const t=await c.Z.menuDetail({id:e.id}),{code:r,data:s,msg:i}=t;200===r?this.ruleForm=s:this.$message.error(i)}else this.$nextTick((()=>{this.$refs.ruleForm.resetFields()}))},handleSave(){try{this.$refs.ruleForm.validate((async e=>{if(e){let e={};e="add"===this.type?{...this.ruleForm,id:u.guid(),parentId:this.treeNode.id,parentIds:this.treeNode.parentIds}:{...this.ruleForm,id:this.treeNode.id,parentId:this.treeNode.parentId,parentIds:this.treeNode.parentIds};const t=await c.Z["add"===this.type?"menuSave":"menuUpdate"](e),{code:r,msg:s}=t;200===r?(this.$message.success(s),this.$emit("refresh",this.treeNode)):this.$message.error(s)}}))}catch(e){console.log(e)}}}},m=h,p=r(1001),f=(0,p.Z)(m,l,a,!1,null,"668985ea",null),b=f.exports,g={name:"index",components:{AddEdit:b,ztree:o.Z},data(){return{zTreeObj:{},treeTool:null,nodes:[],setting:{data:{key:{name:"name"}},check:{enable:!1}},treeNode:{},operateBtns:[{name:"新增",eventName:"add",color:"#409EFF",icon:"el-icon-plus"},{name:"编辑",eventName:"edit",color:"#409EFF",icon:"el-icon-edit"},{name:"删除",eventName:"remove",color:"red",icon:"el-icon-close"}]}},props:{},watch:{},computed:{},mounted(){this.$nextTick((()=>{this.getTree()}))},methods:{async getTree(){const e=await c.Z.menuTree(),{code:t,data:r,msg:s}=e;200===t?this.nodes=r.list||[]:this.$message.error(s)},getTreeObj(e){this.zTreeObj=e.zTreeObj,this.treeTool=e.treeTool},handleClick(e){e&&this.$nextTick((()=>{const t={treeNode:e,disabled:!0,type:"show"};this.$refs.addEdit.getInfo(t)}))},refreshTree(e){this.$nextTick((()=>{this.getTree()}))},addFn(e){this.addEditFn(e,"add")},editFn(e){this.addEditFn(e,"edit")},addEditFn(e,t){e.stopPropagation();const r=this.treeTool.getSelectNode(e);this.zTreeObj.selectNode(r),this.$nextTick((()=>{const e={treeNode:r,disabled:!1,type:t};this.$refs.addEdit.getInfo(e)}))},removeFn(e){e.stopPropagation();const t=this.treeTool.getSelectNode(e);if("root"!==t.id){const e="确定删除该节点吗？";this.$confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await c.Z.menuDelete({id:t.id});console.log(e),200===e.code?(this.$nextTick((()=>{this.getTree()})),this.$message.success(e.msg)):this.$message.error(e.msg)})).catch((()=>{this.$message({type:"error",message:"已取消删除"})}))}},setOperatePrivilege(e){const t=this.operateBtns,r=t.length,s=new Map;for(let o=0;o<r;o++){const e={name:t[o].eventName,color:t[o].color,icon:t[o].icon,hoverTitle:t[o].name};s.set(e,Reflect.get(this,`${t[o].eventName}Fn`))}const i=s;i&&(e.setting.view.addHoverDom=function(e,t){const r=$(`#${t.tId}_a`);i.forEach(((e,s,i)=>{const o=`color:${s.color};margin-left:8px;font-size: 16px;text-decoration: none!important;`;if("root"===t.id&&"add"===s.name||"root"!==t.id&&"btn"!==t.type&&["add","edit","remove"].includes(s.name)||"btn"===t.type&&["edit","remove"].includes(s.name)){if($(`#${s.name}Btn_${t.id}`).length>0)return;let i=`<a style='${o}' class='zTreeButton ${s.name}_ico_docu ${s.icon}' title='${s.hoverTitle}' lang='${t.tId}' id='${s.name}Btn_${t.id}'></a>`;i+=`<input type='hidden' id='${s.name}${t.id}' value='${t.tId}'/>`,r.append(i);const l=$(`#${s.name}Btn_${t.id}`);l&&l.bind("click",e)}}))},e.setting.view.removeHoverDom=function(e,t){i.forEach(((e,r,s)=>{$(`#${r.name}Btn_${t.id}`).unbind().remove(),$(`#${r.name}${t.id}`).unbind().remove()}))})}}},k=g,v=(0,p.Z)(k,s,i,!1,null,"ddd04fe2",null),T=v.exports},64851:function(e,t,r){var s=r(95999);t.Z={menuDetail:e=>(0,s.Z)({url:"/menu/detail",method:"post",data:e}),menuSave:e=>(0,s.Z)({url:"/menu/save",method:"post",data:e}),menuUpdate:e=>(0,s.Z)({url:"/menu/update",method:"post",data:e}),menuTree:e=>(0,s.Z)({url:"/menu/tree",method:"post",data:e}),menuDelete:e=>(0,s.Z)({url:"/menu/delete",method:"post",data:e}),menuUniqueness:e=>(0,s.Z)({url:"/menu/uniqueness",method:"post",data:e})}}}]);
//# sourceMappingURL=894.67f6b2ef.js.map