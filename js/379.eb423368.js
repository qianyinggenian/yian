"use strict";(self["webpackChunkyian"]=self["webpackChunkyian"]||[]).push([[379],{86379:function(e,t,a){a.r(t),a.d(t,{default:function(){return f}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"pdf-viewer"},[t("div",{staticClass:"file-box"},[t("div",{staticClass:"file-select-box"},[t("div",{staticClass:"item"},[t("input",{ref:"uploadBtn",staticStyle:{display:"none"},attrs:{type:"file",accept:".pdf",multiple:""},on:{change:e.onFileChange}}),t("el-button",{attrs:{size:"small"},on:{click:e.handleUpload}},[e._v("选择文件")]),t("span",{staticClass:"file-accept-tips"},[e._v("仅可上传pdf文件")]),e.totalPages>0?t("span",[e._v(" 总共："+e._s(e.totalPages)+"页")]):e._e()],1),t("div",{staticClass:"item"},[t("el-button",{staticClass:"download-btn",attrs:{size:"small",loading:e.loading},on:{click:e.convertToPdfAndDownload}},[e._v(" 下载 ")])],1)]),t("div",{staticClass:"file-list"},e._l(e.files,(function(a,s){return t("div",{key:s,staticClass:"item"},[t("div",{staticClass:"icon"},[t("svg-icon",{attrs:{"icon-class":"pdf2",size:40}})],1),t("div",{staticClass:"content",attrs:{title:a.name}},[t("span",[e._v(e._s(a.name))])]),t("div",{staticClass:"delete-file",on:{click:function(t){return e.deleteFile(a,s)}}},[t("svg-icon",{attrs:{"icon-class":"delete",fill:"#dc2e1b",size:20}})],1)])})),0)]),e.totalPages>0?t("div",{staticClass:"pdf-Box"},[e._l(e.totalPages,(function(e,a){return t("canvas",{key:a,ref:"pages",refInFor:!0,attrs:{id:a}})})),t("el-backtop",{attrs:{target:".pdf-Box"}})],2):e._e()])},l=[],i=(a(16573),a(78100),a(77936),a(44323)),n=a(91100),r=(a(85098),{name:"index",components:{},data(){return{loading:!1,selectedFile:null,pdfDocument:null,arrayBuffer:null,totalPages:0,pdfFiles:[],fileName:"",files:[],fontFamilyList:[{value:"Arial",label:"Arial"},{value:"宋体",label:"宋体"},{value:"楷体",label:"楷体"},{value:"仿宋",label:"仿宋"},{value:"黑体",label:"黑体"},{value:"等线",label:"等线"},{value:"微软雅黑",label:"微软雅黑"},{value:"思源黑体",label:"思源黑体"},{value:"Times New Roman",label:"Times New Roman"},{value:"Helvetica Neue",label:"Helvetica Neue"},{value:"Helvetica",label:"Helvetica"},{value:"PingFang SC",label:"PingFang SC"},{value:"Hiragino Sans GB",label:"Hiragino Sans GB"},{value:"Microsoft YaHei",label:"Microsoft YaHei"},{value:"sans-serif",label:"sans-serif"}],form:{watermarkText:"Watermark",tiltAngle:-30,fontFamily:"Arial",watermarkOpacity:.5,fontSize:20,textSpacing:150,fontColor:"#D02424"}}},props:{},watch:{},computed:{},created(){},mounted(){},methods:{handleUpload(){this.$refs.uploadBtn.value="",this.$refs.uploadBtn.click()},deleteFile(e,t){this.files.splice(t,1),this.totalPages=0,console.log("this.files",this.files);for(const a of this.files)a.type.includes("application/pdf")?this.resetWatermark(a):this.$message.error("请选择PDF文件！")},async onFileChange(e){const t=e.target.files;this.selectedFile=t,this.files=Array.from(t);for(const a of t)a.type.includes("application/pdf")?await this.resetWatermark(a):this.$message.error("请选择PDF文件！")},async resetWatermark(e){const t=await this.readFileAsArrayBuffer(e);this.files&&this.files.length>0&&await this.loadPDF(t)},readFileAsArrayBuffer(e){return new Promise(((t,a)=>{const s=new FileReader;s.onloadend=()=>{s.result instanceof ArrayBuffer?t(s.result):a(new Error("Failed to read the file as ArrayBuffer"))},s.onerror=a,s.readAsArrayBuffer(e)}))},async loadPDF(e){const t=n.YE({data:e}),a=await t.promise,s=a.numPages,l=0===this.totalPages?0:this.totalPages;this.totalPages+=s,a&&this.totalPages>0&&this.$nextTick((()=>{this.renderAllPages(a,l,s)}))},async renderAllPages(e,t,a){for(let s=t;s<this.totalPages;s++)this.$nextTick((async()=>{const a=this.$refs.pages[s];if(!a)return console.error(`Canvas element for page ${s} not found.`),!1;const l=0===t?s+1:s+1-t,i=await e.getPage(l),n=i.getViewport({scale:2});a.width=n.width,a.height=n.height;const r=a.getContext("2d");r.clearRect(0,0,a.width,a.height);const o={canvasContext:r,viewport:n};await i.render(o).promise}))},drawWatermark(e,t,a){const{watermarkText:s,tiltAngle:l,fontSize:i,fontColor:n,watermarkOpacity:r,fontFamily:o,textSpacing:c}=this.form,d=Math.max(a.width,a.height),f=Math.ceil(d/c);for(let g=0;g<f;g++)for(let t=0;t<f;t++){const a=t*c,d=g*c;e.save(),e.translate(a,d),e.rotate(l*Math.PI/180),e.font=`bold ${i}px ${o}`,e.fillStyle=n,e.globalAlpha=r,e.fillText(`${s}`,0,i),e.restore()}},async downloadPDF(){if(this.files&&this.files.length>0){const e=new i.Ay("p","mm","a4"),t=this.$refs.pages;for(let a=0;a<t.length;a++){const s=t[a],l=s.getContext("2d").canvas,i=e.internal.pageSize.getWidth(),n=e.internal.pageSize.getHeight(),r=l.toDataURL(),o=new Image;o.src=r,await new Promise((e=>{o.onload=()=>e()})),e.addImage(o,"PNG",0,0,i,n),a!==t.length-1&&e.addPage()}e.save(`水印-${this.fileName}`)}else this.$message.error("请选择PDF文件！")},async convertToPdfAndDownload(){if(this.files&&this.files.length>0){this.$message.success("开始下载"),this.loading=!0;const e=new i.Ay("p","mm","a4"),t=this.$refs.pages;for(let a=0;a<t.length;a++){const s=t[a],l=s.toDataURL("image/jpeg",1),i=await this.loadImage(l),n=e.internal.pageSize.getWidth(),r=e.internal.pageSize.getHeight();e.addImage(i,"JPEG",0,0,n,r),a!==t.length-1&&e.addPage()}this.$message.success("完成"),this.loading=!1,e.save("pdf合并文件.pdf")}else this.$message.error("请选择PDF文件！")},loadImage(e){return new Promise(((t,a)=>{const s=new Image;s.src=e,s.onload=()=>t(s),s.onerror=a}))}}}),o=r,c=a(81656),d=(0,c.A)(o,s,l,!1,null,"52894de5",null),f=d.exports}}]);
//# sourceMappingURL=379.eb423368.js.map