"use strict";(self["webpackChunkyian"]=self["webpackChunkyian"]||[]).push([[65],{923:function(e){(function(o,n){e.exports=n()})(0,(function(){function e(e){var a=[];return e.AMapUI&&a.push(o(e.AMapUI)),e.Loca&&a.push(n(e.Loca)),Promise.all(a)}function o(e){return new Promise((function(o,n){var r=[];if(e.plugins)for(var l=0;l<e.plugins.length;l+=1)-1==t.AMapUI.plugins.indexOf(e.plugins[l])&&r.push(e.plugins[l]);if(i.AMapUI===a.failed)n("前次请求 AMapUI 失败");else if(i.AMapUI===a.notload){i.AMapUI=a.loading,t.AMapUI.version=e.version||t.AMapUI.version,l=t.AMapUI.version;var c=document.body||document.head,p=document.createElement("script");p.type="text/javascript",p.src="https://webapi.amap.com/ui/"+l+"/main.js",p.onerror=function(e){i.AMapUI=a.failed,n("请求 AMapUI 失败")},p.onload=function(){if(i.AMapUI=a.loaded,r.length)window.AMapUI.loadUI(r,(function(){for(var e=0,n=r.length;e<n;e++){var a=r[e].split("/").slice(-1)[0];window.AMapUI[a]=arguments[e]}for(o();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()}));else for(o();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()},c.appendChild(p)}else i.AMapUI===a.loaded?e.version&&e.version!==t.AMapUI.version?n("不允许多个版本 AMapUI 混用"):r.length?window.AMapUI.loadUI(r,(function(){for(var e=0,n=r.length;e<n;e++){var a=r[e].split("/").slice(-1)[0];window.AMapUI[a]=arguments[e]}o()})):o():e.version&&e.version!==t.AMapUI.version?n("不允许多个版本 AMapUI 混用"):s.AMapUI.push((function(e){e?n(e):r.length?window.AMapUI.loadUI(r,(function(){for(var e=0,n=r.length;e<n;e++){var a=r[e].split("/").slice(-1)[0];window.AMapUI[a]=arguments[e]}o()})):o()}))}))}function n(e){return new Promise((function(o,n){if(i.Loca===a.failed)n("前次请求 Loca 失败");else if(i.Loca===a.notload){i.Loca=a.loading,t.Loca.version=e.version||t.Loca.version;var r=t.Loca.version,l=t.AMap.version.startsWith("2"),c=r.startsWith("2");if(l&&!c||!l&&c)n("JSAPI 与 Loca 版本不对应！！");else{l=t.key,c=document.body||document.head;var p=document.createElement("script");p.type="text/javascript",p.src="https://webapi.amap.com/loca?v="+r+"&key="+l,p.onerror=function(e){i.Loca=a.failed,n("请求 AMapUI 失败")},p.onload=function(){for(i.Loca=a.loaded,o();s.Loca.length;)s.Loca.splice(0,1)[0]()},c.appendChild(p)}}else i.Loca===a.loaded?e.version&&e.version!==t.Loca.version?n("不允许多个版本 Loca 混用"):o():e.version&&e.version!==t.Loca.version?n("不允许多个版本 Loca 混用"):s.Loca.push((function(e){e?n(e):n()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var a;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(a||(a={}));var t={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},i={AMap:a.notload,AMapUI:a.notload,Loca:a.notload},s={AMap:[],AMapUI:[],Loca:[]},r=[],l=function(e){"function"==typeof e&&(i.AMap===a.loaded?e(window.AMap):r.push(e))};return{load:function(o){return new Promise((function(n,s){if(i.AMap==a.failed)s("");else if(i.AMap==a.notload){var c=o.key,p=o.version,d=o.plugins;c?(window.AMap&&"lbs.amap.com"!==location.host&&s("禁止多种API加载方式混用"),t.key=c,t.AMap.version=p||t.AMap.version,t.AMap.plugins=d||t.AMap.plugins,i.AMap=a.loading,p=document.body||document.head,window.___onAPILoaded=function(t){if(delete window.___onAPILoaded,t)i.AMap=a.failed,s(t);else for(i.AMap=a.loaded,e(o).then((function(){n(window.AMap)}))["catch"](s);r.length;)r.splice(0,1)[0]()},d=document.createElement("script"),d.type="text/javascript",d.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+t.AMap.version+"&key="+c+"&plugin="+t.AMap.plugins.join(","),d.onerror=function(e){i.AMap=a.failed,s(e)},p.appendChild(d)):s("请填写key")}else if(i.AMap==a.loaded)if(o.key&&o.key!==t.key)s("多个不一致的 key");else if(o.version&&o.version!==t.AMap.version)s("不允许多个版本 JSAPI 混用");else{if(c=[],o.plugins)for(p=0;p<o.plugins.length;p+=1)-1==t.AMap.plugins.indexOf(o.plugins[p])&&c.push(o.plugins[p]);c.length?window.AMap.plugin(c,(function(){e(o).then((function(){n(window.AMap)}))["catch"](s)})):e(o).then((function(){n(window.AMap)}))["catch"](s)}else if(o.key&&o.key!==t.key)s("多个不一致的 key");else if(o.version&&o.version!==t.AMap.version)s("不允许多个版本 JSAPI 混用");else{var u=[];if(o.plugins)for(p=0;p<o.plugins.length;p+=1)-1==t.AMap.plugins.indexOf(o.plugins[p])&&u.push(o.plugins[p]);l((function(){u.length?window.AMap.plugin(u,(function(){e(o).then((function(){n(window.AMap)}))["catch"](s)})):e(o).then((function(){n(window.AMap)}))["catch"](s)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,t={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},i={AMap:a.notload,AMapUI:a.notload,Loca:a.notload},s={AMap:[],AMapUI:[],Loca:[]}}}}))},65065:function(e,o,n){n.r(o),n.d(o,{default:function(){return m}});var a=function(){var e=this,o=e._self._c;return o("div",{staticClass:"add-edit-container"},[o("el-button",{on:{click:e.exportAsImage}},[e._v("导出")]),o("div",{staticClass:"tool-bar"},[o("el-select",{attrs:{filterable:"",remote:"","reserve-keyword":"",clearable:"",size:"small",disabled:e.readonly,placeholder:"请输入关键字搜索","remote-method":e.remoteMethod},on:{change:e.handleChangeSelect},model:{value:e.formData.locationName,callback:function(o){e.$set(e.formData,"locationName",o)},expression:"formData.locationName"}},e._l(e.suggestions,(function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),o("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowMap,expression:"isShowMap"}],staticStyle:{width:"100%",height:"100%"},attrs:{id:"map-container"}})],1)},t=[],i=(n(18111),n(20116),n(923)),s=n.n(i),r=n(89157),l=n(20354),c=n.n(l);let p,d,u,h;window._AMapSecurityConfig={securityJsCode:r.mk.s};var g={name:"AddEdit",components:{},data(){return{type:"",params:"",keyword:"",currentPolygon:null,readonly:!1,showDialog:!1,isShowMap:!0,formData:{time:null,locationName:"",objectIds:[]},suggestions:[],mapCenter:[113.264499,23.130061]}},watch:{},async mounted(){await this.initAMap()},methods:{initAMap(){s().load({key:r.mk.k,version:"2.0",plugins:["AMap.Scale","AMap.AutoComplete","AMap.PlaceSearch","AMap.ToolBar","AMap.ControlBar","AMap.PolygonEditor","AMap.MouseTool","AMap.MapExport"]}).then((e=>{p=e,d=new p.Map("map-container",{resizeEnable:!0,expandZoomRange:!0,viewMode:"3D",zoom:15,center:this.mapCenter,WebGLParams:{preserveDrawingBuffer:!0}});const o={city:"全国"};u=new p.AutoComplete(o),console.log("加载完成"),this.addMarker(this.mapCenter)})).catch((e=>{console.log(e)}))},exportAsImage(){console.log("mapInstance",d),d.getScreenShot(),console.log("mapInstance.getScreenShot()",d.getScreenShot()),setTimeout((()=>{c()(document.getElementById("map-container"),{useCORS:!0,logging:!0,scale:1}).then((e=>{const o=document.createElement("a");o.download="map.jpg",o.href=e.toDataURL(),o.click()}))}),500)},resetMap(e){this.clearResources(),d.setCenter(e),this.addMarker(e),this.activateDrawing()},handlePolygonUpdate(e){console.log(111111);const o=this.currentPolygon.getPath();console.log("电子围栏坐标:",o)},clearResources(){this.currentMarker&&(d.remove(this.currentMarker),this.currentMarker=null),this.currentPolygon&&(d.remove(this.currentPolygon),this.currentPolygon.close(),this.currentPolygon=null),this.polygonEditor&&(this.polygonEditor.close(),this.polygonEditor=null)},handleChangeSelect(e){const o=this.suggestions.find((o=>o.id===e));o&&this.handleSelect(o)},handleSelect(e){const{location:o,name:n}=e;console.log(n),this.resetMap(o)},setMapCenter(e){d&&d.setCenter(e)},addMarker(e){this.currentMarker=new p.Marker({position:e,icon:"https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png"}),d.add(this.currentMarker)},activateDrawing(){h.polygon({strokeColor:"#1791fc",strokeOpacity:.5,strokeWeight:6,fillColor:"#1791fc",fillOpacity:.4,strokeStyle:"solid"}),h.on("draw",(e=>{console.log("event",e);const o=e.obj.getPath();console.log("getPath",o),this.currentPolygon=new p.Polygon({path:o,strokeColor:"green",strokeWeight:6,strokeOpacity:.2,fillOpacity:.4,fillColor:"#1791fc",zIndex:50,bubble:!0}),d.add(this.currentPolygon),this.fn()}))},remoteMethod(e){this._timer&&clearTimeout(this._timer),this._timer=setTimeout((()=>{e&&this.getSuggestions(e),this._timer=null}),500)},getSuggestions(e){u&&u.search(e,((e,o)=>{const{info:n="",tips:a=[]}=o||{};"OK"===n&&(this.suggestions=a)}))}},beforeDestroy(){d&&d.destroy()}},f=g,M=n(81656),A=(0,M.A)(f,a,t,!1,null,"4ee82b31",null),m=A.exports},89157:function(e,o,n){n.d(o,{mk:function(){return a}});const a={k:"893473ecc9aabccee4b41209a43b1394",s:"b6d7ec59571b092b7a68d8c1cf93acec"}}}]);
//# sourceMappingURL=65.eea28bcd.js.map