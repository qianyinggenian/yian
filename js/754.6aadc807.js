"use strict";(self["webpackChunkyian"]=self["webpackChunkyian"]||[]).push([[754],{46238:function(e,t,s){s.d(t,{A:function(){return h}});var i=function(){var e=this;e._self._c;return e._m(0)},o=[function(){var e=this,t=e._self._c;return t("div",[t("ul",{staticClass:"schema-tree-plus",attrs:{id:"treeDemo"}})])}];class r{constructor(e){this.resourcesTree=e,this.treeNode=null}getTree(){return this.resourcesTree}setOnClick(e){this.resourcesTree.setting.callback.onClick=e}setOnDblClick(e){this.resourcesTree.setting.callback.onDblClick=e}setOnDrag(e){this.resourcesTree.setting.callback.onDrag=e}setOnDrop(e){this.resourcesTree.setting.callback.onDrop=e}setBeforeClick(e){this.resourcesTree.setting.callback.beforeClick=e}setBeforeDblClick(e){this.resourcesTree.setting.callback.beforeDblClick=e}setBeforeExpand(e){this.resourcesTree.setting.callback.beforeExpand=e}setBeforeDrag(e){this.resourcesTree.setting.callback.beforeDrag=e}setBeforeDrop(e){this.resourcesTree.setting.callback.beforeDrop=e}setOnCheck(e){this.resourcesTree.setting.callback.onCheck=e}setBeforeCheck(e){this.resourcesTree.setting.callback.beforeCheck=e}getSelectNode(e){const t=e.target.id,s=t.split("Btn_"),i=$("#"+s[0]+s[1]).val();return this.resourcesTree.getNodeByTId(i)}}var n={name:"index",components:{},data(){return{treeTool:null,zTreeObj:{},defaultSetting:{view:{showIcon:!1,selectedMulti:!1},edit:{enable:!0,showRemoveBtn:!1,showRenameBtn:!1,drag:{isMove:!0,isCopy:!0}},data:{key:{name:"text"},simpleData:{enable:!0,idKey:"id",pIdKey:"parentId"}},check:{enable:!0}},zNodes:[]}},props:{setting:{type:Object,default:()=>{}},nodes:{type:Array,default:()=>[]},diyBeforeClick:{type:Function},diyBeforeCheck:{type:Function},isSelectFirstNode:{type:Boolean,default:!0},isSetOperatePrivilege:{type:Boolean,default:!1},setOperatePrivilege:{type:Function},expandLevel:{type:Number,default:1},expandAll:{type:Boolean,default:!1}},watch:{nodes:{handler(e,t){e!==t&&(this.zNodes=JSON.parse(JSON.stringify(e)),this.$nextTick((()=>{this.initZTree()})))},immediate:!0}},computed:{},mounted(){},methods:{initZTree(){const e=$.extend(!0,this.defaultSetting,this.setting),t=$.fn.zTree.init($("#treeDemo"),e,this.zNodes);if(this.zTreeObj=t,this.treeTool=new r(t),this.treeTool.setBeforeClick(this.beforeClick),this.treeTool.setBeforeCheck(this.beforeCheck),this.treeTool.setOnClick(this.clickNode),this.treeTool.setOnCheck(this.checkNode),this.isSetOperatePrivilege&&this.setOperatePrivilege&&"function"===typeof this.setOperatePrivilege&&this.setOperatePrivilege(this.zTreeObj),this.isSelectFirstNode){const e=this.zTreeObj.getNodes();this.zTreeObj.selectNode(e[0]),this.$emit("click",e[0])}if(this.expandAll)this.zTreeObj.expandAll(!0);else{let e=[];for(let t=0;t<=this.expandLevel;t++){const s=this.zTreeObj.getNodesByParam("level",t,null);e=[...e,...s]}e.forEach((e=>{this.zTreeObj.expandNode(e,!0,!1,!1)}))}this.$emit("treeObj",{zTreeObj:this.zTreeObj,treeTool:this.treeTool})},clickNode(e,t,s,i){e.preventDefault(),this.$emit("click",s)},beforeClick(e,t,s){return!this.diyBeforeClick||"function"!==typeof this.diyBeforeClick||this.diyBeforeClick(e,t,s)},checkNode(e,t,s){e.preventDefault();const i=this.zTreeObj.getCheckedNodes();this.$emit("check",s,i)},beforeCheck(e,t){return!this.diyBeforeCheck||"function"!==typeof this.diyBeforeCheck||this.diyBeforeCheck(e,t)}}},l=n,a=s(81656),c=(0,a.A)(l,i,o,!1,null,"b7042872",null),h=c.exports},27754:function(e,t,s){s.r(t),s.d(t,{default:function(){return f}});var i=function(){var e=this,t=e._self._c;return t("layout",{attrs:{"is-show-left":!1}},[t("div",{staticClass:"layout-responsive-auto--column",attrs:{slot:"right"},slot:"right"},[t("div",{staticClass:"toolbar"},[t("div",[e._v("类型：")]),t("proxySelect",{attrs:{options:e.typeOptions},on:{change:e.handleType},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}})],1),t("div",{staticClass:"layout-responsive-auto__grow content"},[t("ztree",{ref:"ztree",attrs:{nodes:e.nodes,setting:e.setting,"is-set-operate-privilege":!0},on:{treeObj:e.getTreeObj,check:e.handleCheck}})],1),t("div",{staticClass:"btns-box"},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleSave}},[e._v("保存")])],1)])])},o=[],r=s(46238),n=s(3972),l=s(43172),a=s(68606),c=s(7302),h={name:"index",components:{ztree:r.A,proxySelect:n.A},data(){return{type:"",typeId:"",zTreeObj:{},treeTool:null,nodes:[],checkList:[],permissionList:[],setting:{data:{key:{name:"name"}},check:{enable:!0}},treeNode:{},typeOptions:l.xW}},props:{},watch:{},computed:{},mounted(){this.typeId=this.typeOptions[0].id,this.type=this.typeOptions[0].value,this.$nextTick((()=>{this.getInfo()}))},methods:{async getInfo(){const e=await c.A.permissionDetail({id:this.typeId}),{code:t,data:s}=e;200===t&&(this.checkList=s.permission||[],this.$nextTick((()=>{this.getTree()})))},async getTree(){const e=await a.A.menuTree(),{code:t,data:s,msg:i}=e;200===t?(this.nodes=s.list||[],this.checkList.forEach((e=>{this.nodes=this.nodes.map((t=>(t.id===e&&(t.checked=!0),t)))}))):this.$message.error(i)},getTreeObj(e){this.zTreeObj=e.zTreeObj,this.treeTool=e.treeTool},handleType(e){const t=this.typeOptions.find((t=>t.value===e));this.typeId=t?t.id:"",this.$nextTick((()=>{this.getInfo()}))},handleCheck(e,t){console.log("treeNode",e),console.log("checkNodes",t),this.permissionList=t.map((e=>e.id))},handleSave(){this.$confirm("确定保存吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{this.loading=!0;const e={id:this.typeId,type:this.type,permission:this.permissionList},t=await c.A.permissionSave(e);200===t.code?this.$message.success(t.msg):this.$message.error(t.msg),this.loading=!1})).catch((()=>{this.$message({type:"info",message:"已取消保存"})}))}}},d=h,u=s(81656),p=(0,u.A)(d,i,o,!1,null,"4d127ff4",null),f=p.exports},68606:function(e,t,s){var i=s(4995);t.A={menuDetail:e=>(0,i.A)({url:"/menu/detail",method:"post",data:e}),menuSave:e=>(0,i.A)({url:"/menu/save",method:"post",data:e}),menuUpdate:e=>(0,i.A)({url:"/menu/update",method:"post",data:e}),menuTree:e=>(0,i.A)({url:"/menu/tree",method:"post",data:e}),menuDelete:e=>(0,i.A)({url:"/menu/delete",method:"post",data:e}),menuUniqueness:e=>(0,i.A)({url:"/menu/uniqueness",method:"post",data:e})}},43172:function(e,t,s){s.d(t,{GX:function(){return r},uU:function(){return o},xW:function(){return i}});const i=[{value:"超管",label:"超管",id:"EeFDC299-f42b-8cc7-1bfB-dF189C655661"},{value:"用户",label:"用户",id:"C82CB616-1173-2eA6-4dD1-b92EfF2406eb"},{value:"访客",label:"访客",id:"E59Dcfb1-0d6b-11C2-F884-6FC26e9815C3"}],o=[{value:"启用",label:"启用"},{value:"禁用",label:"禁用"}],r=[{value:"1",label:"是"},{value:"0",label:"否"}]}}]);
//# sourceMappingURL=754.6aadc807.js.map