{"version":3,"file":"js/554.083104d0.js","mappings":"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","sources":["webpack://yian/./src/views/videoWatermark/index.vue","webpack://yian/src/views/videoWatermark/index.vue","webpack://yian/./src/views/videoWatermark/index.vue?d631","webpack://yian/./src/views/videoWatermark/index.vue?f3af"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"video-watermark-container\"},[_c('div',{staticClass:\"top\"},[_c('button',{on:{\"click\":_vm.startRecording}},[_vm._v(\"开始录制带水印的视频\")]),_c('button',{on:{\"click\":_vm.stopRecording}},[_vm._v(\"停止录制带水印的视频\")]),_c('a',{ref:\"downloadLink\",staticStyle:{\"display\":\"none\"}})]),_c('div',{staticClass:\"bottom\"},[_c('video',{ref:\"videoElement\",attrs:{\"id\":\"video01\",\"src\":require(\"@/assets/shanghai.mp4\"),\"crossorigin\":\"anonymous\",\"controls\":\"\"},on:{\"canplay\":_vm.onVideoCanPlay,\"pause\":_vm.onVideoPause,\"ended\":_vm.onVideoEnded}}),_c('canvas',{ref:\"canvasElement\",staticClass:\"watermarked-video\"})])])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"video-watermark-container\">\n    <!-- 视频播放与画布绘制部分省略，与之前示例相同 -->\n    <div class=\"top\">\n      <button @click=\"startRecording\">开始录制带水印的视频</button>\n      <button @click=\"stopRecording\">停止录制带水印的视频</button>\n      <a ref=\"downloadLink\" style=\"display: none\"></a>\n    </div>\n   <div class=\"bottom\">\n     <video\n         id=\"video01\"\n         ref=\"videoElement\"\n         src=\"@/assets/shanghai.mp4\"\n         crossorigin=\"anonymous\"\n         controls\n         @canplay=\"onVideoCanPlay\"\n         @pause=\"onVideoPause\"\n         @ended=\"onVideoEnded\"\n     ></video>\n     <canvas\n         ref=\"canvasElement\"\n         class=\"watermarked-video\"\n     ></canvas>\n   </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    // videoSrc: {\n    //   type: String,\n    //   required: true\n    // }\n  },\n  data () {\n    return {\n      videoContext: null,\n      canvasContext: null,\n      // canvasElement: null,\n      watermarkImage: null,\n      isPlaying: false\n    };\n  },\n  mounted () {\n    // document.body.oncontextmenu = function (e) {\n    //   e.preventDefault();\n    // };\n    $('#video01').bind('contextmenu', function () {\n      return false;\n    });\n  },\n  methods: {\n    onVideoCanPlay () {\n      this.isPlaying = true;\n      this.setupCanvas();\n      this.drawFrame();\n      this.$nextTick(() => {\n        this.setupRecorder(); // 初始化 MediaRecorder\n      });\n    },\n    onVideoPause () {\n      this.isPlaying = false;\n    },\n    onVideoEnded () {\n      this.isPlaying = false;\n    },\n    setupCanvas () {\n      const canvas = this.$refs.canvasElement;\n      canvas.width = this.$refs.videoElement.videoWidth;\n      canvas.height = this.$refs.videoElement.videoHeight;\n      console.log('canvas.width', canvas.width);\n      console.log('canvas.height', canvas.height);\n      this.canvasContext = canvas.getContext('2d');\n    },\n    drawFrame () {\n      if (!this.isPlaying) return;\n\n      // 绘制视频帧\n      this.canvasContext.drawImage(\n        this.$refs.videoElement,\n        0,\n        0,\n        this.$refs.canvasElement.width,\n        this.$refs.canvasElement.height\n      );\n\n      // 设置字体样式和颜色\n      this.canvasContext.font = '30px Arial'; // 字体大小和类型\n      this.canvasContext.fillStyle = '#ffffff'; // 文字颜色\n      this.canvasContext.globalAlpha = 0.3; // 设置透明度\n\n      // 计算文字水印的位置，这里假设放在右下角\n      const watermarkText = 'Sample Watermark'; // 水印文字内容\n      const textWidth = this.canvasContext.measureText(watermarkText).width;\n      const watermarkX = this.$refs.canvasElement.width - textWidth - 10;\n      const watermarkY = this.$refs.canvasElement.height - 40; // 考虑到字体高度和可能需要的边距\n\n      // 绘制文字水印\n      this.canvasContext.fillText(watermarkText, watermarkX, watermarkY);\n\n      // 请求下一帧\n      requestAnimationFrame(this.drawFrame);\n    },\n    startRecording () {\n      if (this.mediaRecorder && this.mediaRecorder.state === 'inactive') {\n        this.recordedChunks = [];\n        this.mediaRecorder.start();\n        console.log('Recording started');\n      } else {\n        console.error('MediaRecorder is not initialized or is in an invalid state.');\n      }\n    },\n\n    stopRecording () {\n      if (this.mediaRecorder && this.mediaRecorder.state !== 'inactive') {\n        this.mediaRecorder.stop();\n        console.log('Recording stopped');\n      } else {\n        console.error('Recording was not in progress.');\n      }\n    },\n\n    async downloadRecordedVideo () {\n      const blob = new Blob(this.recordedChunks, { type: 'video/webm' });\n      const url = URL.createObjectURL(blob);\n      this.$refs.downloadLink.href = url;\n      this.$refs.downloadLink.download = 'watermarked_video.webm';\n      this.$refs.downloadLink.click();\n      URL.revokeObjectURL(url);\n    },\n\n    setupRecorder () {\n      const stream = this.$refs.canvasElement.captureStream();\n      this.mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm' });\n\n      this.mediaRecorder.ondataavailable = (event) => {\n        if (event.data.size > 0) {\n          this.recordedChunks.push(event.data);\n        }\n      };\n\n      this.mediaRecorder.onstop = () => {\n        console.log(1111);\n        this.downloadRecordedVideo();\n      };\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.video-watermark-container {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  .top {\n    height: 50px;\n    width: 100%;\n  }\n  .bottom {\n    height: calc(100% - 60px);\n    position: relative;\n  }\n}\n\n.watermarked-video {\n  position: absolute;\n  pointer-events: none;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n}\n</style>\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=2d4dea2d&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=2d4dea2d&prod&lang=scss&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2d4dea2d\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","on","startRecording","_v","stopRecording","ref","staticStyle","attrs","require","onVideoCanPlay","onVideoPause","onVideoEnded","staticRenderFns","props","data","videoContext","canvasContext","watermarkImage","isPlaying","mounted","$","bind","methods","setupCanvas","drawFrame","$nextTick","setupRecorder","canvas","$refs","canvasElement","width","videoElement","videoWidth","height","videoHeight","console","log","getContext","drawImage","font","fillStyle","globalAlpha","watermarkText","textWidth","measureText","watermarkX","watermarkY","fillText","requestAnimationFrame","mediaRecorder","state","recordedChunks","start","error","stop","downloadRecordedVideo","blob","Blob","type","url","URL","createObjectURL","downloadLink","href","download","click","revokeObjectURL","stream","captureStream","MediaRecorder","mimeType","ondataavailable","event","size","push","onstop","component"],"sourceRoot":""}