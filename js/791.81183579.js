"use strict";(self["webpackChunkyian"]=self["webpackChunkyian"]||[]).push([[791],{923:function(e){(function(o,n){e.exports=n()})(0,(function(){function e(e){var a=[];return e.AMapUI&&a.push(o(e.AMapUI)),e.Loca&&a.push(n(e.Loca)),Promise.all(a)}function o(e){return new Promise((function(o,n){var l=[];if(e.plugins)for(var r=0;r<e.plugins.length;r+=1)-1==t.AMapUI.plugins.indexOf(e.plugins[r])&&l.push(e.plugins[r]);if(i.AMapUI===a.failed)n("前次请求 AMapUI 失败");else if(i.AMapUI===a.notload){i.AMapUI=a.loading,t.AMapUI.version=e.version||t.AMapUI.version,r=t.AMapUI.version;var c=document.body||document.head,p=document.createElement("script");p.type="text/javascript",p.src="https://webapi.amap.com/ui/"+r+"/main.js",p.onerror=function(e){i.AMapUI=a.failed,n("请求 AMapUI 失败")},p.onload=function(){if(i.AMapUI=a.loaded,l.length)window.AMapUI.loadUI(l,(function(){for(var e=0,n=l.length;e<n;e++){var a=l[e].split("/").slice(-1)[0];window.AMapUI[a]=arguments[e]}for(o();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()}));else for(o();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()},c.appendChild(p)}else i.AMapUI===a.loaded?e.version&&e.version!==t.AMapUI.version?n("不允许多个版本 AMapUI 混用"):l.length?window.AMapUI.loadUI(l,(function(){for(var e=0,n=l.length;e<n;e++){var a=l[e].split("/").slice(-1)[0];window.AMapUI[a]=arguments[e]}o()})):o():e.version&&e.version!==t.AMapUI.version?n("不允许多个版本 AMapUI 混用"):s.AMapUI.push((function(e){e?n(e):l.length?window.AMapUI.loadUI(l,(function(){for(var e=0,n=l.length;e<n;e++){var a=l[e].split("/").slice(-1)[0];window.AMapUI[a]=arguments[e]}o()})):o()}))}))}function n(e){return new Promise((function(o,n){if(i.Loca===a.failed)n("前次请求 Loca 失败");else if(i.Loca===a.notload){i.Loca=a.loading,t.Loca.version=e.version||t.Loca.version;var l=t.Loca.version,r=t.AMap.version.startsWith("2"),c=l.startsWith("2");if(r&&!c||!r&&c)n("JSAPI 与 Loca 版本不对应！！");else{r=t.key,c=document.body||document.head;var p=document.createElement("script");p.type="text/javascript",p.src="https://webapi.amap.com/loca?v="+l+"&key="+r,p.onerror=function(e){i.Loca=a.failed,n("请求 AMapUI 失败")},p.onload=function(){for(i.Loca=a.loaded,o();s.Loca.length;)s.Loca.splice(0,1)[0]()},c.appendChild(p)}}else i.Loca===a.loaded?e.version&&e.version!==t.Loca.version?n("不允许多个版本 Loca 混用"):o():e.version&&e.version!==t.Loca.version?n("不允许多个版本 Loca 混用"):s.Loca.push((function(e){e?n(e):n()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var a;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(a||(a={}));var t={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},i={AMap:a.notload,AMapUI:a.notload,Loca:a.notload},s={AMap:[],AMapUI:[],Loca:[]},l=[],r=function(e){"function"==typeof e&&(i.AMap===a.loaded?e(window.AMap):l.push(e))};return{load:function(o){return new Promise((function(n,s){if(i.AMap==a.failed)s("");else if(i.AMap==a.notload){var c=o.key,p=o.version,d=o.plugins;c?(window.AMap&&"lbs.amap.com"!==location.host&&s("禁止多种API加载方式混用"),t.key=c,t.AMap.version=p||t.AMap.version,t.AMap.plugins=d||t.AMap.plugins,i.AMap=a.loading,p=document.body||document.head,window.___onAPILoaded=function(t){if(delete window.___onAPILoaded,t)i.AMap=a.failed,s(t);else for(i.AMap=a.loaded,e(o).then((function(){n(window.AMap)}))["catch"](s);l.length;)l.splice(0,1)[0]()},d=document.createElement("script"),d.type="text/javascript",d.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+t.AMap.version+"&key="+c+"&plugin="+t.AMap.plugins.join(","),d.onerror=function(e){i.AMap=a.failed,s(e)},p.appendChild(d)):s("请填写key")}else if(i.AMap==a.loaded)if(o.key&&o.key!==t.key)s("多个不一致的 key");else if(o.version&&o.version!==t.AMap.version)s("不允许多个版本 JSAPI 混用");else{if(c=[],o.plugins)for(p=0;p<o.plugins.length;p+=1)-1==t.AMap.plugins.indexOf(o.plugins[p])&&c.push(o.plugins[p]);c.length?window.AMap.plugin(c,(function(){e(o).then((function(){n(window.AMap)}))["catch"](s)})):e(o).then((function(){n(window.AMap)}))["catch"](s)}else if(o.key&&o.key!==t.key)s("多个不一致的 key");else if(o.version&&o.version!==t.AMap.version)s("不允许多个版本 JSAPI 混用");else{var u=[];if(o.plugins)for(p=0;p<o.plugins.length;p+=1)-1==t.AMap.plugins.indexOf(o.plugins[p])&&u.push(o.plugins[p]);r((function(){u.length?window.AMap.plugin(u,(function(){e(o).then((function(){n(window.AMap)}))["catch"](s)})):e(o).then((function(){n(window.AMap)}))["catch"](s)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,t={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},i={AMap:a.notload,AMapUI:a.notload,Loca:a.notload},s={AMap:[],AMapUI:[],Loca:[]}}}}))},79791:function(e,o,n){n.r(o),n.d(o,{default:function(){return f}});var a=function(){var e=this,o=e._self._c;return o("div",{staticClass:"map-wrapper"},[o("div",{staticClass:"tool-bar"},[o("el-select",{attrs:{filterable:"",remote:"","reserve-keyword":"",clearable:"",size:"small",disabled:e.readonly,placeholder:"请输入关键字搜索","remote-method":e.remoteMethod},on:{change:e.handleChangeSelect},model:{value:e.formData.locationName,callback:function(o){e.$set(e.formData,"locationName",o)},expression:"formData.locationName"}},e._l(e.suggestions,(function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),o("div",{attrs:{id:"map-container"}}),o("div",{staticClass:"draw-btn"},[o("button",{on:{click:e.startDrawing}},[e._v("开始绘制")]),o("button",{on:{click:e.resetDrawing}},[e._v("重画")])])])},t=[],i=(n(18111),n(20116),n(61701),n(923)),s=n.n(i),l=n(89157);let r,c;var p={data(){return{formData:{time:null,locationName:"",objectIds:[]},readonly:!1,suggestions:[],mapCenter:[113.264499,23.130061],map:null,currentMarker:null,mouseTool:null,editor:null,currentPolygon:null}},async mounted(){await this.initMap()},methods:{async initMap(){try{window._AMapSecurityConfig={securityJsCode:l.mk.s},r=await s().load({key:l.mk.k,version:"2.0",plugins:["AMap.MouseTool","AMap.PolyEditor","AMap.AutoComplete"]}),this.map=new r.Map("map-container",{viewMode:"3D",zoom:15,center:this.mapCenter,resizeEnable:!0});const e={city:"全国"};c=new r.AutoComplete(e),this.addMarker(this.mapCenter),console.log("地图初始化完成")}catch(e){console.error("地图初始化失败:",e)}},resetDrawing(){this.currentPolygon&&(this.map.remove(this.currentPolygon),this.currentPolygon=null,this.editor&&(this.editor.close(),this.editor=null),this.startDrawing())},async startDrawing(){try{this.mouseTool&&this.mouseTool.close(!0),this.mouseTool=new r.MouseTool(this.map),this.mouseTool.polygon({strokeColor:"#1890FF",fillColor:"#1890FF",fillOpacity:.2,strokeWeight:3}),this.mouseTool.on("draw",(async e=>{this.currentPolygon=e.obj,console.log("绘制完成，路径:",e.obj.getPath()),this.editor=new r.PolyEditor(this.map,this.currentPolygon),this.editor.open(),this.editor.on("adjust",(({target:e,lnglat:o,pixel:n})=>{console.log("节点调整后路径:",e.getPath().map((e=>[e.lng,e.lat])))})),this.editor.on("addnode",(({target:e,lnglat:o,pixel:n})=>{console.log("增加节点调整后路径:",e.getPath().map((e=>[e.lng,e.lat])))})),this.mouseTool.close()}))}catch(e){console.error("绘制失败:",e)}},addMarker(e){this.currentMarker&&(this.map.remove(this.currentMarker),this.currentMarker=null),this.currentMarker=new r.Marker({position:e,icon:"https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png"}),this.map.add(this.currentMarker)},handleChangeSelect(e){const o=this.suggestions.find((o=>o.id===e));o&&this.handleSelect(o)},handleSelect(e){const{location:o,name:n}=e;console.log(n),this.setMapCenter(o),this.addMarker(o)},setMapCenter(e){this.map&&this.map.setCenter(e)},remoteMethod(e){this._timer&&clearTimeout(this._timer),this._timer=setTimeout((()=>{e&&this.getSuggestions(e),this._timer=null}),500)},getSuggestions(e){console.log("keyword",e),c&&(console.log(111111),c.search(e,((e,o)=>{console.log("result",o);const{info:n="",tips:a=[]}=o||{};"OK"===n&&(this.suggestions=a)})))}},beforeDestroy(){this.mouseTool&&this.mouseTool.close(!0),this.map&&this.map.destroy()}},d=p,u=n(81656),h=(0,u.A)(d,a,t,!1,null,"185f140a",null),f=h.exports},89157:function(e,o,n){n.d(o,{mk:function(){return a}});const a={k:"893473ecc9aabccee4b41209a43b1394",s:"b6d7ec59571b092b7a68d8c1cf93acec"}}}]);
//# sourceMappingURL=791.81183579.js.map