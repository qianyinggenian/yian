{"version":3,"file":"js/281.7a346e4f.js","mappings":"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","sources":["webpack://yian/./src/views/PDFMerge/index.vue?21f3","webpack://yian/./src/views/PDFMerge/index.vue?900b","webpack://yian/./src/views/PDFMerge/index.vue","webpack://yian/src/views/PDFMerge/index.vue"],"sourcesContent":["import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=de08b9fc&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=de08b9fc&prod&scoped=true&lang=scss\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"de08b9fc\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js\"","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"pdf-viewer\"},[_c('div',{staticClass:\"file-box\"},[_c('div',{staticClass:\"file-select-box\"},[_c('input',{ref:\"uploadBtn\",staticStyle:{\"display\":\"none\"},attrs:{\"type\":\"file\",\"accept\":\".pdf\",\"multiple\":\"\"},on:{\"change\":_vm.onFileChange}}),_c('el-button',{attrs:{\"size\":\"small\"},on:{\"click\":_vm.handleUpload}},[_vm._v(\"选择文件\")]),_c('span',{staticClass:\"file-accept-tips\"},[_vm._v(\"pdf文件\")]),_c('el-button',{attrs:{\"size\":\"small\"},on:{\"click\":_vm.convertToPdfAndDownload}},[_vm._v(\"下载\")])],1),_c('div',{staticClass:\"file-list\"},_vm._l((_vm.selectedFile),function(item,index){return _c('div',{key:index,staticClass:\"item\"},[_vm._v(_vm._s(item.name))])}),0)]),(_vm.totalPages > 0)?_c('div',{staticClass:\"pdf-Box\"},_vm._l((_vm.totalPages),function(_,index){return _c('canvas',{key:index,ref:\"pages\",refInFor:true,attrs:{\"id\":index}})}),0):_vm._e()])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"pdf-viewer\" >\n    <div class=\"file-box\">\n      <div class=\"file-select-box\">\n        <input style=\"display: none\" type=\"file\" ref=\"uploadBtn\" accept=\".pdf\" multiple  @change=\"onFileChange\">\n        <el-button size=\"small\" @click=\"handleUpload\">选择文件</el-button>\n        <span class=\"file-accept-tips\">pdf文件</span>\n        <el-button size=\"small\" @click=\"convertToPdfAndDownload\">下载</el-button>\n      </div>\n      <div class=\"file-list\">\n        <div class=\"item\" v-for=\"(item,index) in selectedFile\" :key=\"index\">{{item.name}}</div>\n      </div>\n    </div>\n    <div class=\"pdf-Box\" v-if=\"totalPages > 0\">\n      <canvas :id=\"index\"  v-for=\"(_, index) in totalPages\" :key=\"index\" ref=\"pages\"></canvas>\n    </div>\n  </div>\n</template>\n<script>\nimport JsPDF from 'jspdf';\nimport * as pdfjsLib from 'pdfjs-dist';\nimport 'pdfjs-dist/build/pdf.worker.min';\nexport default {\n  name: 'index',\n  components: {},\n  data () {\n    return {\n      selectedFile: null,\n      pdfDocument: null,\n      arrayBuffer: null,\n      totalPages: 0,\n      files: [],\n      pdfFiles: [],\n      fileName: '',\n      fontFamilyList: [\n        {\n          value: 'Arial',\n          label: 'Arial'\n        },\n        {\n          value: '宋体',\n          label: '宋体'\n        },\n        {\n          value: '楷体',\n          label: '楷体'\n        },\n        {\n          value: '仿宋',\n          label: '仿宋'\n        },\n        {\n          value: '黑体',\n          label: '黑体'\n        },\n        {\n          value: '等线',\n          label: '等线'\n        },\n        {\n          value: '微软雅黑',\n          label: '微软雅黑'\n        },\n        {\n          value: '思源黑体',\n          label: '思源黑体'\n        },\n        {\n          value: 'Times New Roman',\n          label: 'Times New Roman'\n        },\n        {\n          value: 'Helvetica Neue',\n          label: 'Helvetica Neue'\n        },\n        {\n          value: 'Helvetica',\n          label: 'Helvetica'\n        },\n        {\n          value: 'PingFang SC',\n          label: 'PingFang SC'\n        },\n        {\n          value: 'Hiragino Sans GB',\n          label: 'Hiragino Sans GB'\n        },\n        {\n          value: 'Microsoft YaHei',\n          label: 'Microsoft YaHei'\n        },\n        {\n          value: 'sans-serif',\n          label: 'sans-serif'\n        }\n      ],\n      form: {\n        watermarkText: 'Watermark',\n        tiltAngle: -30,\n        fontFamily: 'Arial',\n        watermarkOpacity: 0.5,\n        fontSize: 20,\n        textSpacing: 150,\n        fontColor: '#D02424'\n      }\n    };\n  },\n  props: {},\n  watch: {},\n  computed: {},\n  created () {},\n  mounted () {\n    // const startPageNum = this.totalPages === 0 ? 1 : this.totalPages;\n    // console.log('startPageNum', startPageNum);\n  },\n  methods: {\n    // download,\n    /**\n     * @Description\n     * @author qianyinggenian\n     * @date 2024/3/19\n     */\n    handleUpload () {\n      this.$refs.uploadBtn.click();\n    },\n    /**\n     * @Description 选择文件后触发\n     * @author qianyinggenian\n     * @date 2024/3/18\n     */\n    async onFileChange (event) {\n      const file = event.target.files[0];\n      const files = event.target.files;\n      this.selectedFile = files;\n      console.log('file', file);\n      console.log('files', files);\n      // const arrayBuffer = await this.readFileAsArrayBuffer(file);\n      // console.log('arrayBuffer', arrayBuffer);\n      for (const item of files) {\n        await this.resetWatermark(item);\n      }\n    },\n    /**\n     * @Description 重置水印\n     * @author qianyinggenian\n     * @date 2024/3/19\n     */\n    async resetWatermark (file) {\n      const arrayBuffer = await this.readFileAsArrayBuffer(file);\n      if (this.selectedFile) {\n        await this.loadPDF(arrayBuffer);\n      }\n    },\n    /**\n     * @Description 读取文件为ArrayBuffer\n     * @author qianyinggenian\n     * @date 2024/3/18\n     */\n    readFileAsArrayBuffer (file) {\n      return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onloadend = () => {\n          if (reader.result instanceof ArrayBuffer) {\n            resolve(reader.result);\n          } else {\n            reject(new Error('Failed to read the file as ArrayBuffer'));\n          }\n        };\n        reader.onerror = reject;\n        reader.readAsArrayBuffer(file);\n      });\n    },\n    async loadPDF (data) {\n      const loadingTask = pdfjsLib.getDocument({ data });\n      // this.pdfDocument = await loadingTask.promise;\n      // this.totalPages += this.pdfDocument.numPages;\n      const pdfDocument = await loadingTask.promise;\n      const numPages = pdfDocument.numPages;\n      console.log('totalPagestotalPages', this.totalPages);\n      const startPageNum = this.totalPages === 0 ? 0 : this.totalPages;\n      this.totalPages += numPages;\n      console.log('totalPages', this.totalPages);\n      // if (this.pdfDocument && this.totalPages > 0) {\n      if (pdfDocument && this.totalPages > 0) {\n        this.$nextTick(() => {\n          this.renderAllPages(pdfDocument, startPageNum, numPages);\n        });\n      }\n    },\n    /**\n     * @Description 渲染\n     * @author qianyinggenian\n     * @date 2024/3/18\n     */\n    async renderAllPages (pdfDocument, startPageNum, numPages) {\n      console.log('startPageNum', startPageNum);\n      console.log('numPages', numPages);\n      // for (let pageNum = startPageNum; pageNum <= this.totalPages; pageNum++) {\n      for (let pageNum = startPageNum; pageNum < this.totalPages; pageNum++) {\n        console.log('pageNum', pageNum);\n        this.$nextTick(async () => {\n          // const canvas = this.$refs.pages[pageNum - 1];\n          const canvas = this.$refs.pages[pageNum];\n          if (!canvas) {\n            console.error(`Canvas element for page ${pageNum} not found.`);\n            return false;\n          }\n          // const page = await this.pdfDocument.getPage(pageNum);\n          const pdfPageNum = startPageNum === 0 ? pageNum + 1 : pageNum + 1 - startPageNum;\n          // console.log('pdfPageNum', pdfPageNum);\n          // const page = await pdfDocument.getPage(pageNum + 1);\n          // const page = await pdfDocument.getPage(pageNum + 1);\n          const page = await pdfDocument.getPage(pdfPageNum);\n          const viewport = page.getViewport({ scale: 2 });\n          canvas.width = viewport.width;\n          canvas.height = viewport.height;\n          const context = canvas.getContext('2d');\n          context.clearRect(0, 0, canvas.width, canvas.height); // 清除canvas上的所有内容\n          const renderContext = {\n            canvasContext: context,\n            viewport\n          };\n\n          await page.render(renderContext).promise;\n          this.drawWatermark(context, pageNum, canvas);\n        });\n      }\n    },\n    /**\n     * @Description 添加水印\n     * @author qianyinggenian\n     * @date 2024/3/18\n     */\n    drawWatermark (context, pageNumber, canvas) {\n      const {\n        watermarkText,\n        tiltAngle,\n        fontSize,\n        fontColor,\n        watermarkOpacity,\n        fontFamily,\n        textSpacing\n      } = this.form;\n      // const textSpacing = 150; // 水印之间的间距\n      const num = Math.max(canvas.width, canvas.height);\n      const numWatermarks = Math.ceil(num / textSpacing);\n\n      for (let i = 0; i < numWatermarks; i++) {\n        for (let j = 0; j < numWatermarks; j++) {\n          const x = j * textSpacing;\n          const y = i * textSpacing;\n          context.save();\n          context.translate(x, y);\n          context.rotate((tiltAngle * Math.PI) / 180);\n          context.font = `bold ${fontSize}px ${fontFamily}`;\n          context.fillStyle = fontColor;\n          context.globalAlpha = watermarkOpacity;\n          context.fillText(`${watermarkText}`, 0, fontSize);\n          context.restore();\n        }\n      }\n    },\n    /**\n     * @Description 下载pdf\n     * @author qianyinggenian\n     * @date 2024/3/18\n     */\n    async downloadPDF () {\n      if (this.selectedFile) {\n        const doc = new JsPDF('p', 'mm', 'a4'); // 设置为纵向、毫米单位、A4纸张\n\n        const canvases = this.$refs.pages; // 示例中包含两个canvas\n\n        for (let i = 0; i < canvases.length; i++) {\n          const canvas = canvases[i];\n          const canvasElement = canvas.getContext('2d').canvas; // 获取canvas DOM元素\n\n          // 计算canvas在PDF页面上的居中坐标\n          // const canvasWidth = canvasElement.width;\n          // const canvasHeight = canvasElement.height;\n          const pdfWidth = doc.internal.pageSize.getWidth();\n          const pdfHeight = doc.internal.pageSize.getHeight();\n\n          // 将canvas转换为data URL\n          const dataUrl = canvasElement.toDataURL();\n\n          // 将data URL转换为image\n          const img = new Image();\n          img.src = dataUrl;\n          await new Promise((resolve) => {\n            img.onload = () => resolve();\n          });\n\n          // 添加图像至PDF，并居中显示\n          // doc.addImage(img, 'PNG', centerX, centerY, canvasWidth, canvasHeight);\n          doc.addImage(img, 'PNG', 0, 0, pdfWidth, pdfHeight);\n\n          // 如果有更多canvas且不是最后一张，则增加新页\n          if (i !== canvases.length - 1) {\n            doc.addPage();\n          }\n        }\n\n        // 生成并下载PDF文件\n        // doc.save(`${this.fileName}.pdf`);\n        doc.save(`水印-${this.fileName}`);\n      } else {\n        this.$message.error('请选择PDF文件！');\n      }\n    },\n    /**\n     * @Description 下载pdf\n     * @author qianyinggenian\n     * @date 2024/3/18\n     */\n    async convertToPdfAndDownload () {\n      if (this.selectedFile) {\n        const pdf = new JsPDF('p', 'mm', 'a4'); // 初始化PDF文档\n\n        // 遍历所有的canvas元素\n        const canvases = this.$refs.pages; // 示例列表，根据实际情况替换为你的canvas refs\n        for (let i = 0; i < canvases.length; i++) {\n          const canvasRef = canvases[i];\n          // 将canvas转换为图像数据\n          const canvasImgData = canvasRef.toDataURL('image/jpeg', 1.0);\n          // const canvasImgData = canvas.toDataURL('image/jpeg');\n\n          // 将图像数据转换为PDF可用的图像\n          const img = await this.loadImage(canvasImgData);\n          // 获取canvas的实际大小\n          // const canvasWidth = canvas.clientWidth;\n          // const canvasHeight = canvas.clientHeight;\n          // console.log(canvasWidth, canvasWidth);\n          // console.log(canvasHeight, canvasHeight);\n          const pdfWidth = pdf.internal.pageSize.getWidth();\n          const pdfHeight = pdf.internal.pageSize.getHeight();\n          // 添加图像到PDF文档\n          // pdf.addImage(img, 'JPEG', 15, 40, canvasWidth, canvasHeight); // 调整坐标和尺寸以适应你的布局\n          pdf.addImage(img, 'JPEG', 0, 0, pdfWidth, pdfHeight); // 调整坐标和尺寸以适应你的布局\n\n          // 添加页面分隔（如果需要在每个canvas后换页）\n          // 如果有更多canvas且不是最后一张，则增加新页\n          if (i !== canvases.length - 1) {\n            pdf.addPage();\n          }\n        }\n\n        // 生成并下载PDF文件\n        // pdf.save(`${this.fileName}.pdf`);\n        pdf.save('pdf合并文件.pdf');\n      } else {\n        this.$message.error('请选择PDF文件！');\n      }\n    },\n    loadImage (dataUrl) {\n      return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.src = dataUrl;\n        img.onload = () => resolve(img);\n        img.onerror = reject;\n      });\n    }\n  }\n};\n</script>\n<style scoped lang=\"scss\">\n.pdf-viewer {\n  width: 100%;\n  height: 100%;\n  .file-box {\n    padding: 10px;\n    box-sizing: border-box;\n    .file-select-box {\n      .file-accept-tips {\n        margin-left: 10px;\n      }\n    }\n  }\n  canvas {\n    width: calc(100% - 10px);\n    margin: 0 5px 10px 5px;\n  }\n}\n</style>\n"],"names":["component","render","_vm","this","_c","_self","staticClass","ref","staticStyle","attrs","on","onFileChange","handleUpload","_v","convertToPdfAndDownload","_l","selectedFile","item","index","key","_s","name","totalPages","_","refInFor","_e","staticRenderFns","components","data","pdfDocument","arrayBuffer","files","pdfFiles","fileName","fontFamilyList","value","label","form","watermarkText","tiltAngle","fontFamily","watermarkOpacity","fontSize","textSpacing","fontColor","props","watch","computed","created","mounted","methods","$refs","uploadBtn","click","event","file","target","console","log","resetWatermark","readFileAsArrayBuffer","loadPDF","Promise","resolve","reject","reader","FileReader","onloadend","result","ArrayBuffer","Error","onerror","readAsArrayBuffer","loadingTask","pdfjsLib","promise","numPages","startPageNum","$nextTick","renderAllPages","pageNum","canvas","pages","error","pdfPageNum","page","getPage","viewport","getViewport","scale","width","height","context","getContext","clearRect","renderContext","canvasContext","drawWatermark","pageNumber","num","Math","max","numWatermarks","ceil","i","j","x","y","save","translate","rotate","PI","font","fillStyle","globalAlpha","fillText","restore","downloadPDF","doc","JsPDF","canvases","length","canvasElement","pdfWidth","internal","pageSize","getWidth","pdfHeight","getHeight","dataUrl","toDataURL","img","Image","src","onload","addImage","addPage","$message","pdf","canvasRef","canvasImgData","loadImage"],"sourceRoot":""}