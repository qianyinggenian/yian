"use strict";(self["webpackChunkyian"]=self["webpackChunkyian"]||[]).push([[822],{26822:function(e,t,a){a.r(t),a.d(t,{default:function(){return c}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"pdf-viewer"},[t("el-form",{ref:"form",attrs:{model:e.form,size:"small","label-width":"80px"}},[t("el-row",{attrs:{type:"flex",justify:"space-between"}},[t("el-col",{attrs:{span:24}},[t("el-form-item",[t("input",{attrs:{type:"file",accept:".pdf"},on:{change:e.onFileChange}})])],1)],1),t("el-row",{attrs:{type:"flex",justify:"space-around",gutter:20}},[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"水印内容",prop:"watermarkText",title:e.form.watermarkText}},[t("el-input",{attrs:{clearable:""},model:{value:e.form.watermarkText,callback:function(t){e.$set(e.form,"watermarkText",t)},expression:"form.watermarkText"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"字体",prop:"fontFamily"}},[t("el-select",{attrs:{size:"small",filterable:"",placeholder:"请选择"},model:{value:e.form.fontFamily,callback:function(t){e.$set(e.form,"fontFamily",t)},expression:"form.fontFamily"}},e._l(e.fontFamilyList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"字体大小",prop:"fontSize"}},[t("el-input-number",{attrs:{min:10,max:100},model:{value:e.form.fontSize,callback:function(t){e.$set(e.form,"fontSize",t)},expression:"form.fontSize"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"透明度",prop:"watermarkOpacity"}},[t("el-input-number",{attrs:{step:.1,min:0,max:1},model:{value:e.form.watermarkOpacity,callback:function(t){e.$set(e.form,"watermarkOpacity",t)},expression:"form.watermarkOpacity"}})],1)],1)],1),t("el-row",{attrs:{type:"flex",justify:"space-between",gutter:20}},[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"倾斜角度",prop:"tiltAngle"}},[t("el-input-number",{attrs:{min:-90,max:90},model:{value:e.form.tiltAngle,callback:function(t){e.$set(e.form,"tiltAngle",t)},expression:"form.tiltAngle"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"间隔距离",prop:"textSpacing"}},[t("el-input-number",{attrs:{step:1,min:100,max:200},model:{value:e.form.textSpacing,callback:function(t){e.$set(e.form,"textSpacing",t)},expression:"form.textSpacing"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"字体颜色",prop:"fontColor"}},[t("el-color-picker",{model:{value:e.form.fontColor,callback:function(t){e.$set(e.form,"fontColor",t)},expression:"form.fontColor"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",[t("el-button",{staticClass:"download-btn",attrs:{type:"primary",loading:e.loading},on:{click:e.convertToPdfAndDownload}},[e._v(" 下载 ")])],1)],1)],1)],1),e.totalPages>0?t("div",{staticClass:"pdf-Box"},[e._l(e.totalPages,(function(e,a){return t("canvas",{key:a,ref:"pages",refInFor:!0})})),t("el-backtop",{attrs:{target:".pdf-Box"}})],2):e._e()],1)},r=[],s=(a(16573),a(78100),a(77936),a(44323)),o=a(91100),i=(a(85098),{data(){return{loading:!1,selectedFile:null,pdfDocument:null,arrayBuffer:null,totalPages:0,fileName:"",fontFamilyList:[{value:"Arial",label:"Arial"},{value:"宋体",label:"宋体"},{value:"楷体",label:"楷体"},{value:"仿宋",label:"仿宋"},{value:"黑体",label:"黑体"},{value:"等线",label:"等线"},{value:"微软雅黑",label:"微软雅黑"},{value:"思源黑体",label:"思源黑体"},{value:"Times New Roman",label:"Times New Roman"},{value:"Helvetica Neue",label:"Helvetica Neue"},{value:"Helvetica",label:"Helvetica"},{value:"PingFang SC",label:"PingFang SC"},{value:"Hiragino Sans GB",label:"Hiragino Sans GB"},{value:"Microsoft YaHei",label:"Microsoft YaHei"},{value:"sans-serif",label:"sans-serif"}],form:{watermarkText:"Watermark",tiltAngle:-30,fontFamily:"Arial",watermarkOpacity:.5,fontSize:20,textSpacing:150,fontColor:"#D02424"}}},watch:{form:{handler(e,t){this.selectedFile&&this.resetWatermark(this.selectedFile)},deep:!0}},async mounted(){},methods:{async onFileChange(e){const t=e.target.files[0];t&&"application/pdf"===t.type?(this.fileName=t.name||"水印文档.pdf",this.selectedFile=t,this.selectedFile&&await this.resetWatermark(t)):this.$message.error("请选择PDF文件！")},async resetWatermark(e){const t=await this.readFileAsArrayBuffer(e);this.selectedFile&&await this.loadPDF(t)},readFileAsArrayBuffer(e){return new Promise(((t,a)=>{const l=new FileReader;l.onloadend=()=>{l.result instanceof ArrayBuffer?t(l.result):a(new Error("Failed to read the file as ArrayBuffer"))},l.onerror=a,l.readAsArrayBuffer(e)}))},async loadPDF(e){const t=o.YE({data:e});this.pdfDocument=await t.promise,this.totalPages=this.pdfDocument.numPages,this.pdfDocument&&this.totalPages>0&&this.$nextTick((()=>{this.renderAllPages()}))},async renderAllPages(){for(let e=1;e<=this.totalPages;e++)this.$nextTick((async()=>{const t=this.$refs.pages[e-1];if(!t)return console.error(`Canvas element for page ${e} not found.`),!1;const a=await this.pdfDocument.getPage(e),l=a.getViewport({scale:2});t.width=l.width,t.height=l.height;const r=t.getContext("2d");r.clearRect(0,0,t.width,t.height);const s={canvasContext:r,viewport:l};await a.render(s).promise,this.drawWatermark(r,e,t)}))},drawWatermark(e,t,a){const{watermarkText:l,tiltAngle:r,fontSize:s,fontColor:o,watermarkOpacity:i,fontFamily:n,textSpacing:f}=this.form,m=Math.max(a.width,a.height),c=Math.ceil(m/f);for(let p=0;p<c;p++)for(let t=0;t<c;t++){const a=t*f,m=p*f;e.save(),e.translate(a,m),e.rotate(r*Math.PI/180),e.font=`bold ${s}px ${n}`,e.fillStyle=o,e.globalAlpha=i,e.fillText(`${l}`,0,s),e.restore()}},async downloadPDF(){if(this.selectedFile){const e=new s.Ay("p","mm","a4"),t=this.$refs.pages;for(let a=0;a<t.length;a++){const l=t[a],r=l.getContext("2d").canvas,s=e.internal.pageSize.getWidth(),o=e.internal.pageSize.getHeight(),i=r.toDataURL(),n=new Image;n.src=i,await new Promise((e=>{n.onload=()=>e()})),e.addImage(n,"PNG",0,0,s,o),a!==t.length-1&&e.addPage()}e.save(`水印-${this.fileName}`)}else this.$message.error("请选择PDF文件！")},async convertToPdfAndDownload(){if(this.selectedFile){this.$message.success("开始下载"),this.loading=!0;const e=new s.Ay("p","mm","a4"),t=this.$refs.pages;for(let a=0;a<t.length;a++){const l=t[a],r=l.toDataURL("image/jpeg",1),s=await this.loadImage(r),o=e.internal.pageSize.getWidth(),i=e.internal.pageSize.getHeight();e.addImage(s,"JPEG",0,0,o,i),a!==t.length-1&&e.addPage()}this.$message.success("完成"),this.loading=!1,e.save(`水印-${this.fileName}`)}else this.$message.error("请选择PDF文件！")},loadImage(e){return new Promise(((t,a)=>{const l=new Image;l.src=e,l.onload=()=>t(l),l.onerror=a}))}}}),n=i,f=a(81656),m=(0,f.A)(n,l,r,!1,null,"54834789",null),c=m.exports}}]);
//# sourceMappingURL=822.948f0ea7.js.map